import{l as e,F as l,S as a,m as o,n as t,o as r,p as u,q as d,r as n,R as i,s,t as c,u as v,v as m,w as p,x as h,y as f,C as g,z as b,D as w,g as k,B as y,E as V,G as _,H as x,J as M,K as C}from"../@arco-design/@arco-design.02825e82.js";import{e as z,t as j,r as S,w as U,k as A,l as N,m as W,v as P,n as T,$ as B,y as E,z as F,p as L,M as H,N as K,o as q,C as G}from"../@vue/@vue.39664cb3.js";import{T as D,S as I,a as J,K as O,C as R,H as $,E as Q,b as X,G as Y,c as Z,d as ee}from"../@antv/@antv.354d31c8.js";import{b as le}from"../vue-router/vue-router.5c0bd928.js";import{u as ae,l as oe,f as te}from"../data/data.b5814fd9.js";import{e as re,n as ue}from"../lodash-es/lodash-es.5d7a2e52.js";import{a as de}from"../vue3-colorpicker/vue3-colorpicker.88804826.js";import{s as ne}from"../pinia/pinia.a4fb185b.js";import{v as ie}from"../uuid/uuid.ba5d26a9.js";import"../resize-observer-polyfill/resize-observer-polyfill.ad543aa3.js";import"../compute-scroll-into-view/compute-scroll-into-view.2962e95c.js";import"../b-tween/b-tween.5055d79e.js";import"../dayjs/dayjs.37468663.js";import"../crypto-js/crypto-js.930e5814.js";import"../scroll-into-view-if-needed/scroll-into-view-if-needed.f139de06.js";import"../b-validate/b-validate.457088db.js";import"../number-precision/number-precision.d9b928a1.js";import"../mousetrap/mousetrap.890cce9b.js";import"../lyc-storage/lyc-storage.5b5a1c46.js";import"../../static/index-03977020.js";import"../nprogress/nprogress.02fc88c0.js";import"../@vueuse/@vueuse.11702cf4.js";import"../tinycolor2/tinycolor2.2b8234f4.js";import"../gradient-parser/gradient-parser.96402e16.js";import"../vue-types/vue-types.52f94848.js";import"../is-plain-object/is-plain-object.32bf4cc1.js";import"../@aesoper/@aesoper.4b44138d.js";import"../@popperjs/@popperjs.396dda61.js";const se=(e,l)=>{for(let a=0,o=e.length;a<o;a+=1)e[a].style.visibility=l?"visible":"hidden"},ce=e=>"none"!=e?{name:e,width:12,height:8}:null,ve=e=>{const l=new Map([["edge-editor",{name:"edge-editor",args:{attrs:{text:{fontSize:15}}}}],["vertices",{name:"vertices",modifiers:["crtl","meta "]}],["segments",{name:"segments"}],["boundary",{name:"boundary"}],["button-remove",{name:"button-remove",args:{distance:"50%"}}],["source-arrowhead",{name:"source-arrowhead"}],["target-arrowhead",{name:"target-arrowhead"}]]);return e.map((e=>l.get(e)))},me=e=>{let l={};return l="rounded"==e?{radius:8}:{radius:8,type:"arc",size:8},l},pe=e=>({position:e,attrs:{circle:{r:4.5,magnet:!0,stroke:"#000",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}}),he=e=>{const{width:l,height:a,shape:o}=e;return{inherit:o,width:l,height:a,attrs:{body:{strokeWidth:1.5,stroke:"#000000",fill:"#ffffff"},text:{fontSize:12,fill:"#262626",textAnchor:"middle",textVerticalAnchor:"middle"},label:{textWrap:{width:"90%",height:"90%",ellipsis:!0,breakWord:!0}}},ports:{groups:{top:pe("top"),right:pe("right"),bottom:pe("bottom"),left:pe("left")}}}},fe=e=>(e||["top","bottom","left","right"]).map((e=>({group:e}))),ge=(e,l)=>{let{refPoints:a,width:o,height:t,port:r}=l;return o=o||33,t=t||18,e.createNode({shape:"custom-polygon",width:o,height:t,attrs:{body:{refPoints:a}},ports:{items:fe(r)}})},be=(e,l)=>{const{rx:a,ry:o,port:t}=l;return e.createNode({shape:"custom-rect",attrs:{body:{rx:a,ry:o}},ports:{items:fe(t)}})},we=e=>{const l=be(e,{rx:0,ry:0}),a=be(e,{rx:6,ry:6}),o=be(e,{rx:10,ry:13}),t=((e,l)=>e.createNode({shape:"custom-ellipse",ports:{items:fe(l)}}))(e),r=((e,l)=>e.createNode({shape:"custom-circle",ports:{items:fe(l)}}))(e);return[l,a,o,t,r,ge(e,{refPoints:"10,0 40,0 30,20 0,20"}),ge(e,{refPoints:"0,10 10,0 20,10 10,20"}),ge(e,{height:25,width:25,refPoints:"0.5,0 0.61,0.35 1,0.35 0.68,0.57 0.79,0.91 0.5,0.75 0.21,0.91 0.32,0.57 0,0.35 0.39,0.35"}),ge(e,{refPoints:"0,0 0,1 1,1",port:["left","bottom"]}),ge(e,{height:22,width:25,refPoints:"0.5,0 1,1 0,1"}),ge(e,{height:25,refPoints:"0.5,0 1,0.38 0.82,1 0.18,1 0,0.38"}),ge(e,{height:28,width:28,refPoints:"0.5,0 1,0.25 1,0.75 0.5,1 0,0.75 0,0.25"}),ge(e,{height:33,refPoints:"0.5,0 0.85,0.15 1,0.5 0.85,0.85 0.5,1 0.15,0.85 0,0.5 0.15,0.15"})]},ke=z({__name:"index",props:{model:{}},emits:["change"],setup(r,{expose:u,emit:d}){const n=r,i=d,{model:s}=j(n),c=S(s.value),v={name:{message:"绘图名称必须填写",required:!0,type:"string"},desc:{message:"绘图备注必须填写",required:!0,type:"string"},exportType:{message:"导出图片的类型必须选择",required:!0,type:"string"}},m=[{label:"png格式",value:"png"},{label:"jpeg格式",value:"jpeg"},{label:"svg格式",value:"svg"}],p=S();return U(s,(e=>{c.value=re(e)}),{deep:!0}),u({validate:()=>p.value.validate()}),(r,u)=>{const d=e,n=l,s=a,h=o,f=t;return A(),N(f,{model:c.value,rules:v,layout:"vertical","label-align":"left","auto-label-width":"",ref_key:"formIns",ref:p},{default:W((()=>[P(n,{label:"名称",field:"name","validate-trigger":"blur"},{default:W((()=>[P(d,{modelValue:c.value.name,"onUpdate:modelValue":u[0]||(u[0]=e=>c.value.name=e),placeholder:"请输入绘图名称",onChange:u[1]||(u[1]=e=>i("change","name",c.value.name))},null,8,["modelValue"])])),_:1}),P(n,{label:"导出类型",field:"exportType","validate-trigger":"blur"},{default:W((()=>[P(s,{modelValue:c.value.exportType,"onUpdate:modelValue":u[2]||(u[2]=e=>c.value.exportType=e),options:m,onChange:u[3]||(u[3]=e=>i("change","exportType",c.value.exportType)),placeholder:"请选择导出图片的类型"},null,8,["modelValue"])])),_:1}),P(n,{label:"备注",field:"desc","validate-trigger":"blur"},{default:W((()=>[P(h,{modelValue:c.value.desc,"onUpdate:modelValue":u[4]||(u[4]=e=>c.value.desc=e),placeholder:"请输入此次绘图的备注","auto-size":{minRows:5},onChange:u[5]||(u[5]=e=>i("change","desc",c.value.desc))},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])}}}),ye={class:"slider-container"},Ve={class:"color"},_e=T("span",{class:"iconfont line-color"},"",-1),xe={class:"slider-container"},Me={class:"slider-container"},Ce=z({__name:"index",props:{property:{}},emits:["change"],setup(e,{emit:a}){const o=e,d=a,{property:n}=j(o),i=S(n.value);return U(n,(e=>{i.value=re(e)}),{deep:!0}),U(i,(e=>{ue(e,n.value)||d("change",e)}),{deep:!0}),(e,a)=>{const o=r,d=l,s=u,c=t;return A(),N(c,{model:B(n),"label-align":"left","auto-label-width":""},{default:W((()=>[P(d,{label:"线条宽度",field:"strokeWidth"},{default:W((()=>[T("div",ye,[P(o,{modelValue:i.value.strokeWidth,"onUpdate:modelValue":a[0]||(a[0]=e=>i.value.strokeWidth=e),modelModifiers:{lazy:!0},min:1,max:100,"show-input":""},null,8,["modelValue"])])])),_:1}),P(d,{label:"线条颜色",field:"strokeColor"},{default:W((()=>[T("div",Ve,[P(B(de),{pureColor:i.value.strokeColor,"onUpdate:pureColor":a[1]||(a[1]=e=>i.value.strokeColor=e),format:"hex6"},null,8,["pureColor"]),P(s,null,{icon:W((()=>[_e])),default:W((()=>[E(" "+F(i.value.strokeColor),1)])),_:1})])])),_:1}),P(d,{label:"箭头宽度",field:"markerWidth"},{default:W((()=>[T("div",xe,[P(o,{modelValue:i.value.markerWidth,"onUpdate:modelValue":a[2]||(a[2]=e=>i.value.markerWidth=e),modelModifiers:{lazy:!0},min:5,max:100,"show-input":""},null,8,["modelValue"])])])),_:1}),P(d,{label:"箭头高度",field:"markerHeight"},{default:W((()=>[T("div",Me,[P(o,{modelValue:i.value.markerHeight,"onUpdate:modelValue":a[3]||(a[3]=e=>i.value.markerHeight=e),modelModifiers:{lazy:!0},min:5,max:100,"show-input":""},null,8,["modelValue"])])])),_:1})])),_:1},8,["model"])}}}),ze={class:"slider-container"},je={class:"slider-container"},Se={class:"color"},Ue={class:"slider-container"},Ae={class:"color"},Ne={class:"slider-container"},We={class:"color"},Pe=T("span",{class:"iconfont line-color"},"",-1),Te=z({__name:"index",props:{property:{}},emits:["change"],setup(e,{emit:a}){const o=e,c=a,{property:v}=j(o),m=S(v.value);return U(v,(e=>{m.value=re(e)}),{deep:!0}),U(m,(e=>{ue(v.value,e)||c("change",e)}),{deep:!0}),(e,a)=>{const o=r,c=l,p=u,h=i,f=s,g=t;return A(),N(g,{model:B(v),"label-align":"left","auto-label-width":""},{default:W((()=>[P(c,{label:"高度",field:"height"},{default:W((()=>[T("div",ze,[P(o,{modelValue:m.value.height,"onUpdate:modelValue":a[0]||(a[0]=e=>m.value.height=e),modelModifiers:{lazy:!0},min:10,max:1e3,"show-input":""},null,8,["modelValue"])])])),_:1}),P(c,{label:"宽度",field:"width"},{default:W((()=>[T("div",je,[P(o,{modelValue:m.value.width,"onUpdate:modelValue":a[1]||(a[1]=e=>m.value.width=e),modelModifiers:{lazy:!0},min:10,max:1e3,"show-input":""},null,8,["modelValue"])])])),_:1}),P(c,{label:"填充颜色",field:"background"},{default:W((()=>[T("div",Se,[P(B(de),{pureColor:m.value.background,"onUpdate:pureColor":a[2]||(a[2]=e=>m.value.background=e),format:"hex6"},null,8,["pureColor"]),P(p,null,{icon:W((()=>[P(B(d),{size:16})])),default:W((()=>[E(" "+F(m.value.background),1)])),_:1})])])),_:1}),P(c,{label:"字体大小",field:"fontSize"},{default:W((()=>[T("div",Ue,[P(o,{modelValue:m.value.fontSize,"onUpdate:modelValue":a[3]||(a[3]=e=>m.value.fontSize=e),modelModifiers:{lazy:!0},min:10,max:100,"show-input":""},null,8,["modelValue"])])])),_:1}),P(c,{label:"字体颜色",field:"fontColor"},{default:W((()=>[T("div",Ae,[P(B(de),{pureColor:m.value.fontColor,"onUpdate:pureColor":a[4]||(a[4]=e=>m.value.fontColor=e),format:"hex6"},null,8,["pureColor"]),P(p,null,{icon:W((()=>[P(B(n),{size:15})])),default:W((()=>[E(" "+F(m.value.fontColor),1)])),_:1})])])),_:1}),P(c,{label:"水平对齐",field:"textAnchor"},{default:W((()=>[P(f,{modelValue:m.value.textAnchor,"onUpdate:modelValue":a[5]||(a[5]=e=>m.value.textAnchor=e),type:"button",size:"small"},{default:W((()=>[P(h,{value:"end"},{default:W((()=>[E("向左")])),_:1}),P(h,{value:"middle"},{default:W((()=>[E("两端")])),_:1}),P(h,{value:"start"},{default:W((()=>[E("向右")])),_:1})])),_:1},8,["modelValue"])])),_:1}),P(c,{label:"垂直对齐",field:"textVerticalAnchor"},{default:W((()=>[P(f,{modelValue:m.value.textVerticalAnchor,"onUpdate:modelValue":a[6]||(a[6]=e=>m.value.textVerticalAnchor=e),type:"button",size:"small"},{default:W((()=>[P(h,{value:"bottom"},{default:W((()=>[E("顶部")])),_:1}),P(h,{value:"middle"},{default:W((()=>[E("居中")])),_:1}),P(h,{value:"top"},{default:W((()=>[E("底部")])),_:1})])),_:1},8,["modelValue"])])),_:1}),P(c,{label:"线条宽度",field:"borderSize"},{default:W((()=>[T("div",Ne,[P(o,{modelValue:m.value.borderSize,"onUpdate:modelValue":a[7]||(a[7]=e=>m.value.borderSize=e),modelModifiers:{lazy:!0},min:1,max:100,"show-input":""},null,8,["modelValue"])])])),_:1}),P(c,{label:"线条颜色",field:"borderColor"},{default:W((()=>[T("div",We,[P(B(de),{pureColor:m.value.borderColor,"onUpdate:pureColor":a[8]||(a[8]=e=>m.value.borderColor=e),format:"hex6"},null,8,["pureColor"]),P(p,null,{icon:W((()=>[Pe])),default:W((()=>[E(" "+F(m.value.borderColor),1)])),_:1})])])),_:1})])),_:1},8,["model"])}}}),Be=z({__name:"index",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(e,{emit:l}){const a=l,o=e=>{a("update:modelValue",e)};return(e,l)=>{const a=m;return A(),L("div",null,[P(a,{"model-value":e.modelValue,"checked-value":!0,"unchecked-value":!1,"checked-text":"开启","unchecked-text":"关闭",onChange:o},{"checked-icon":W((()=>[P(B(c))])),"unchecked-icon":W((()=>[P(B(v))])),default:W((()=>[E("> "),E("> ")])),_:1},8,["model-value"])])}}}),Ee=T("span",{class:"title"},"画布属性：",-1),Fe={class:"color"},Le={class:"slider-container"},He={class:"label"},Ke=T("span",null,"节点嵌套",-1),qe={class:"label"},Ge=T("span",null,"空白连接",-1),De={class:"label"},Ie=T("span",null,"空白连接",-1),Je={class:"label"},Oe=T("span",null,"循环连接",-1),Re={class:"label"},$e=T("span",null,"多边连接",-1),Qe={class:"label"},Xe=T("span",null,"连接高光",-1),Ye={class:"label"},Ze=T("span",null,"节点拖拽",-1),el={class:"label"},ll=T("span",null,"边拖拽",-1),al={class:"label"},ol=T("span",null,"边标签拖拽",-1),tl={class:"label"},rl=T("span",null,"箭头拖拽",-1),ul=T("span",{class:"title"},"线条属性：",-1),dl={class:"label"},nl=T("span",null,"路由模式",-1),il={class:"label"},sl=T("span",null,"连接器",-1),cl={class:"label"},vl=T("span",null,"自动吸附",-1),ml={class:"slider-container"},pl={class:"label"},hl=T("span",null,"边上工具",-1),fl=z({__name:"index",props:{property:{}},setup(e,{expose:o}){const n=e,{property:i}=j(n),s=S(i.value),c=[{label:"没有箭头",value:"none"},{label:"实心箭头",value:"block"},{label:"经典箭头",value:"classic"},{label:"菱形箭头",value:"diamond"},{label:"圆形箭头",value:"circle"},{label:"圆形和加号箭头",value:"circlePlus"},{label:"椭圆箭头",value:"ellipse"},{label:"交叉箭头",value:"cross"},{label:"async",value:"async"}],v=[{label:"内置路由",value:"normal"},{label:"正交路由",value:"orth"},{label:"受限正交路由",value:"oneSide"},{label:"智能正交路由",value:"manhattan"},{label:"智能地铁线路由",value:"metro"},{label:"实体关系路由",value:"er"}],m=[{label:"简单连接器",value:"normal"},{label:"平滑连接器",value:"smooth"},{label:"圆角连接器",value:"rounded"},{label:"跳线连接器",value:"jumpover"}],g=[{label:"文本编辑工具",value:"edge-editor"},{label:"起点修改工具",value:"source-arrowhead"},{label:"终点修改工具",value:"target-arrowhead"},{label:"路径点工具",value:"vertices"},{label:"矩形框工具",value:"boundary"},{label:"删除工具",value:"button-remove"},{label:"线段工具",value:"segments"}];return o({getFormValue:()=>s.value}),(e,o)=>{const n=u,b=l,w=r,k=h,y=a,V=f,_=t;return A(),N(_,{model:B(i),"label-align":"left","auto-label-width":""},{default:W((()=>[Ee,P(b,{label:"背景色",field:"background"},{default:W((()=>[T("div",Fe,[P(B(de),{pureColor:s.value.background,"onUpdate:pureColor":o[0]||(o[0]=e=>s.value.background=e),format:"hex6"},null,8,["pureColor"]),P(n,null,{icon:W((()=>[P(B(d),{size:16})])),default:W((()=>[E(" "+F(s.value.background),1)])),_:1})])])),_:1}),P(b,{label:"画布缩放",field:"mousewheel"},{default:W((()=>[P(Be,{modelValue:s.value.mousewheel,"onUpdate:modelValue":o[1]||(o[1]=e=>s.value.mousewheel=e)},null,8,["modelValue"])])),_:1}),H(P(b,{label:"缩放倍率",field:"scale"},{default:W((()=>[T("div",Le,[P(w,{modelValue:s.value.scale,"onUpdate:modelValue":o[2]||(o[2]=e=>s.value.scale=e),min:.1,max:5,step:.1,range:"","show-input":""},null,8,["modelValue"])])])),_:1},512),[[K,s.value.mousewheel]]),P(b,{label:"画布平移",field:"panning"},{default:W((()=>[P(Be,{modelValue:s.value.panning,"onUpdate:modelValue":o[3]||(o[3]=e=>s.value.panning=e)},null,8,["modelValue"])])),_:1}),P(b,{field:"embedding"},{label:W((()=>[T("div",He,[Ke,P(k,{content:"是否允许一个节点在另外一个节点内部成为子节点，默认为true。"},{default:W((()=>[P(B(p))])),_:1})])])),default:W((()=>[P(Be,{modelValue:s.value.embedding,"onUpdate:modelValue":o[4]||(o[4]=e=>s.value.embedding=e)},null,8,["modelValue"])])),_:1}),P(b,{field:"allowBlank"},{label:W((()=>[T("div",qe,[Ge,P(k,{content:"是否允许连接到画布空白位置的点，默认为true。"},{default:W((()=>[P(B(p))])),_:1})])])),default:W((()=>[P(Be,{modelValue:s.value.allowBlank,"onUpdate:modelValue":o[5]||(o[5]=e=>s.value.allowBlank=e)},null,8,["modelValue"])])),_:1}),P(b,{field:"allowBlank"},{label:W((()=>[T("div",De,[Ie,P(k,{content:"是否允许连接到画布空白位置的点，默认为true。"},{default:W((()=>[P(B(p))])),_:1})])])),default:W((()=>[P(Be,{modelValue:s.value.allowBlank,"onUpdate:modelValue":o[6]||(o[6]=e=>s.value.allowBlank=e)},null,8,["modelValue"])])),_:1}),P(b,{field:"allowLoop"},{label:W((()=>[T("div",Je,[Oe,P(k,{content:"是否允许创建循环连线，即边的起始节点和终止节点为同一节点，默认为true。"},{default:W((()=>[P(B(p))])),_:1})])])),default:W((()=>[P(Be,{modelValue:s.value.allowLoop,"onUpdate:modelValue":o[7]||(o[7]=e=>s.value.allowLoop=e)},null,8,["modelValue"])])),_:1}),P(b,{field:"allowMulti"},{label:W((()=>[T("div",Re,[$e,P(k,{content:"是否允许在相同的起始节点和终止之间创建多条边，默认为true。\r\n            当设置为 false 时，在起始和终止节点之间只允许创建一条边。"},{default:W((()=>[P(B(p))])),_:1})])])),default:W((()=>[P(Be,{modelValue:s.value.allowMulti,"onUpdate:modelValue":o[8]||(o[8]=e=>s.value.allowMulti=e)},null,8,["modelValue"])])),_:1}),P(b,{field:"highlight"},{label:W((()=>[T("div",Qe,[Xe,P(k,{content:"拖动边时，是否高亮显示所有可用的连接桩或节点，默认值为false。"},{default:W((()=>[P(B(p))])),_:1})])])),default:W((()=>[P(Be,{modelValue:s.value.highlight,"onUpdate:modelValue":o[9]||(o[9]=e=>s.value.highlight=e)},null,8,["modelValue"])])),_:1}),P(b,{field:"nodeMovable"},{label:W((()=>[T("div",Ye,[Ze,P(k,{content:"节点是否可以被移动，默认值为true"},{default:W((()=>[P(B(p))])),_:1})])])),default:W((()=>[P(Be,{modelValue:s.value.nodeMovable,"onUpdate:modelValue":o[10]||(o[10]=e=>s.value.nodeMovable=e)},null,8,["modelValue"])])),_:1}),P(b,{field:"edgeMovable"},{label:W((()=>[T("div",el,[ll,P(k,{content:"边是否可以被移动，默认值为true。"},{default:W((()=>[P(B(p))])),_:1})])])),default:W((()=>[P(Be,{modelValue:s.value.edgeMovable,"onUpdate:modelValue":o[11]||(o[11]=e=>s.value.edgeMovable=e)},null,8,["modelValue"])])),_:1}),P(b,{field:"edgeMovable"},{label:W((()=>[T("div",al,[ol,P(k,{content:"边的标签是否可以被移动，默认值为true。"},{default:W((()=>[P(B(p))])),_:1})])])),default:W((()=>[P(Be,{modelValue:s.value.edgeLabelMovable,"onUpdate:modelValue":o[12]||(o[12]=e=>s.value.edgeLabelMovable=e)},null,8,["modelValue"])])),_:1}),P(b,{field:"arrowheadMovable"},{label:W((()=>[T("div",tl,[rl,P(k,{content:"边的起始/终止箭头是否可以被移动，默认值为true。"},{default:W((()=>[P(B(p))])),_:1})])])),default:W((()=>[P(Be,{modelValue:s.value.arrowheadMovable,"onUpdate:modelValue":o[13]||(o[13]=e=>s.value.arrowheadMovable=e)},null,8,["modelValue"])])),_:1}),ul,P(b,{label:"起点箭头",field:"sourceMarker"},{default:W((()=>[P(y,{modelValue:s.value.sourceMarker,"onUpdate:modelValue":o[14]||(o[14]=e=>s.value.sourceMarker=e),placeholder:"请选择起点箭头类型",options:c},null,8,["modelValue"])])),_:1}),P(b,{label:"终点箭头",field:"targetMarker"},{default:W((()=>[P(y,{modelValue:s.value.targetMarker,"onUpdate:modelValue":o[15]||(o[15]=e=>s.value.targetMarker=e),placeholder:"请选择终点箭头类型",options:c},null,8,["modelValue"])])),_:1}),P(b,{field:"router"},{label:W((()=>[T("div",dl,[nl,P(k,{content:"路由将边的路径点 vertices 做进一步转换处理，并在必要时添加额外的点，然后返回处理后的点（不包含边的起点和终点）。例如，经过 orth 路由处理后，边的每一条线段都是水平或垂直的正交线段，默认为\t智能正交路由。"},{default:W((()=>[P(B(p))])),_:1})])])),default:W((()=>[P(y,{modelValue:s.value.router,"onUpdate:modelValue":o[16]||(o[16]=e=>s.value.router=e),placeholder:"请选择路由模式",options:v},null,8,["modelValue"])])),_:1}),P(b,{field:"connector"},{label:W((()=>[T("div",il,[sl,P(k,{content:"连接起点、终点、路有点的连线类型，默认值为圆角连接器"},{default:W((()=>[P(B(p))])),_:1})])])),default:W((()=>[P(y,{modelValue:s.value.connector,"onUpdate:modelValue":o[17]||(o[17]=e=>s.value.connector=e),placeholder:"请选择连接器",options:m},null,8,["modelValue"])])),_:1}),P(b,{field:"snap"},{label:W((()=>[T("div",cl,[vl,P(k,{content:"开启和关闭连线过程中自动吸附，数值大小代表吸附距离，默认值是20px。"},{default:W((()=>[P(B(p))])),_:1})])])),default:W((()=>[T("div",ml,[P(w,{modelValue:s.value.snap,"onUpdate:modelValue":o[18]||(o[18]=e=>s.value.snap=e),modelModifiers:{lazy:!0},min:1,max:100,"show-input":""},null,8,["modelValue"])])])),_:1}),P(b,{field:"lineTools"},{label:W((()=>[T("div",pl,[hl,P(k,{content:"开启边的一些小工具便于操作，默认有边上编辑工具。"},{default:W((()=>[P(B(p))])),_:1})])])),default:W((()=>[P(V,{modelValue:s.value.lineTools,"onUpdate:modelValue":o[19]||(o[19]=e=>s.value.lineTools=e),options:g},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])}}}),gl={class:"draw"},bl={class:"operation"},wl={class:"footer"},kl={class:"footer"},yl=z({__name:"index",setup(e){const{userData:l}=ne(ae()),a=le().query.id+"",o=S(),t=S(),r=S(),u=S({id:"",name:"",desc:"",data:"",exportType:"png",createTime:"",updateTime:""}),d=S(""),n=S("node"),i=S({width:0,height:0,fontColor:"",fontSize:0,background:"",borderColor:"",borderSize:0,textAnchor:"",textVerticalAnchor:""}),s=S({strokeColor:"",strokeWidth:0,markerHeight:0,markerWidth:0}),c=S("global"),v=S(oe.get("setting")||{background:"#ffffff",mousewheel:!0,scale:[.3,3],panning:!0,embedding:!0,allowBlank:!0,allowLoop:!0,allowMulti:!0,allowPort:!0,highlight:!1,allowEdge:!0,allowNode:!0,nodeMovable:!0,edgeMovable:!0,edgeLabelMovable:!0,arrowheadMovable:!0,vertexMovable:!0,vertexAddable:!0,vertexDeletable:!0,sourceMarker:"none",targetMarker:"block",router:"manhattan",connector:"rounded",snap:20,lineTools:["edge-editor"],nodeTools:["node-editor"]}),m=S(),p=S(),h=S(.73),f=e=>{d.value=e.id,n.value="node";const l=e.getAttrs(),{width:a,height:o}=e.getProp("size"),{body:{fill:t,stroke:r,strokeWidth:u},text:{fill:s,fontSize:c,textAnchor:v,textVerticalAnchor:m}}=l;i.value={width:a,height:o,fontSize:Number(c),fontColor:String(s),borderColor:String(r),borderSize:Number(u),background:String(t),textAnchor:String(v),textVerticalAnchor:String(m)}},z=e=>{d.value=e.id,n.value="line";const l=e.getAttrs(),{line:{stroke:a,strokeWidth:o,targetMarker:t}}=l,{height:r,width:u}=Object(t);s.value={strokeWidth:Number(o),strokeColor:String(a),markerHeight:r||0,markerWidth:u||0}},j=e=>{const l=o.value.getCellById(d.value),{background:a,borderColor:t,borderSize:r,fontColor:u,fontSize:n,textAnchor:s,textVerticalAnchor:c,height:v,width:m}=e;l.setAttrs({body:{fill:a,stroke:t,strokeWidth:r},text:{fill:u,fontSize:n,textAnchor:s,textVerticalAnchor:c}}),l.setProp("size",{width:m,height:v}),i.value=e},U=e=>{const l=o.value.getCellById(d.value),{markerWidth:a,markerHeight:t,strokeWidth:r,strokeColor:u}=e;l.setAttrs({line:{stroke:u,strokeWidth:r,sourceMarker:{height:t,width:a},targetMarker:{height:t,width:a}}}),s.value=e},N=(e,l)=>{u.value[e]=l},F=()=>{const{exportType:e}=u.value;"png"==e?o.value.exportPNG():"jpeg"==e?o.value.exportJPEG():o.value.exportSVG()},re=async()=>{var e;if(await(null==(e=m.value)?void 0:e.validate()))return c.value="draw",k.error("请填写完整绘图名称和绘图备注后，在进行保存！");u.value.data=JSON.stringify(o.value.toJSON().cells);const t=l.value.findIndex((e=>e.id==a));if(-1!=t)u.value.updateTime=te(new Date),l.value[t]=u.value,k.success("修改保存成功！");else{u.value.id=ie();const e=new Date;u.value.createTime=te(e),u.value.updateTime=te(e),l.value.push(u.value),k.success("新增保存成功！")}},ue=()=>{oe.set("setting",p.value.getFormValue()),location.reload()},de=async()=>{var e,s;Y.registerNode("custom-rect",he({shape:"rect",width:33,height:18}),!0),Y.registerNode("custom-polygon",he({shape:"polygon",width:33,height:18}),!0),Y.registerNode("custom-circle",he({shape:"circle",width:23,height:23}),!0),Y.registerNode("custom-ellipse",he({shape:"ellipse",width:33,height:18}),!0),o.value=(e=t.value,new Y({container:e,background:{color:v.value.background},grid:{type:"doubleMesh",size:12,visible:!0,args:[{color:"#eee",thickness:1},{color:"#ddd",thickness:1,factor:4}]},embedding:v.value.embedding,mousewheel:{enabled:v.value.mousewheel,zoomAtMousePosition:!0,modifiers:["ctrl","meta"],minScale:v.value.scale[0],maxScale:v.value.scale[1]},interacting:{edgeLabelMovable:v.value.edgeLabelMovable,edgeMovable:v.value.edgeMovable,arrowheadMovable:v.value.arrowheadMovable,nodeMovable:v.value.nodeMovable},connecting:{router:v.value.router,anchor:"center",connectionPoint:"anchor",connector:{name:v.value.connector,args:me(v.value.connector)},snap:{radius:v.value.snap},allowBlank:v.value.allowBlank,allowEdge:v.value.allowEdge,allowPort:v.value.allowPort,allowLoop:v.value.allowLoop,allowMulti:v.value.allowMulti,allowNode:v.value.allowNode,highlight:v.value.highlight,createEdge(){const e=new Z({attrs:{line:{stroke:"#000000",strokeWidth:2,sourceMarker:ce(v.value.sourceMarker),targetMarker:ce(v.value.targetMarker)}},tools:ve(v.value.lineTools),zIndex:0});return d.value=e.id,c.value="node",n.value="line",z(e),e},validateConnection:({targetMagnet:e})=>!!e},highlighting:{magnetAdsorbed:{name:"stroke",args:{attrs:{fill:"#5F95FF",stroke:"#5F95FF",strokeWidth:5}}}}})),(e=>{e.use(new D({resizing:{enabled:!0,preserveAspectRatio:!0},rotating:{enabled:!0}})).use(new I({rubberband:!0,showNodeSelectionBox:!0,showEdgeSelectionBox:!0})).use(new J({className:"snapline"})).use(new O).use(new R).use(new $).use(new Q).use(new X({modifiers:["ctrl","meta"],pannable:!0})),e.lockScroller()})(o.value),(e=>{var l;const a=new ee({title:"流程图基础图形",target:e,stencilGraphWidth:200,stencilGraphHeight:250,collapsable:!1,groups:[{title:"基础图形",name:"node"}],layoutOptions:{columns:3,columnWidth:53,rowHeight:45},getDropNode(e){const l=e.size(),a=e.clone().size({height:2*l.height,width:2*l.width});return a.addTools([{name:"node-editor",args:{attrs:{text:{fontSize:15}}}}]),c.value="node",f(a),a}});a.load(we(e),"node"),null==(l=r.value)||l.appendChild(a.container)})(o.value),(e=>{e.bindKey(["meta+c","ctrl+c"],(()=>{const l=e.getSelectedCells();return l.length&&e.copy(l),!1})),e.bindKey(["meta+x","ctrl+x"],(()=>{const l=e.getSelectedCells();return l.length&&e.cut(l),!1})),e.bindKey(["meta+v","ctrl+v"],(()=>{if(!e.isClipboardEmpty()){const l=e.paste({offset:32});e.cleanSelection(),e.select(l)}return!1})),e.bindKey(["meta+z","ctrl+z"],(()=>(e.canUndo()&&e.undo(),!1))),e.bindKey(["meta+shift+z","ctrl+shift+z"],(()=>(e.canRedo()&&e.redo(),!1))),e.bindKey(["meta+a","ctrl+a"],(()=>{const l=e.getNodes();l&&e.select(l)})),e.bindKey("backspace",(()=>{const l=e.getSelectedCells();l.length&&e.removeCells(l)}))})(o.value),(s=o.value).on("node:mouseenter",(()=>{const e=t.value.querySelectorAll(".x6-port-body");se(e,!0)})),s.on("node:mouseleave",(()=>{const e=t.value.querySelectorAll(".x6-port-body");se(e,!1)})),s.on("node:click",(({cell:e})=>{c.value="node",d.value!=e.id&&f(e)})),s.on("edge:click",(({cell:e})=>{c.value="node",d.value!=e.id&&z(e)})),s.on("node:removed",(({cell:e})=>{e.id==d.value&&(d.value="")})),s.on("edge:removed",(({cell:e})=>{e.id==d.value&&(d.value="")})),s.on("node:change:size",(({cell:e})=>{if(d.value!=e.id)return;const{height:l,width:a}=e.getProp("size");i.value.height=l,i.value.width=a})),(()=>{var e;const{panning:l}=v.value;l||null==(e=o.value)||e.disablePanning()})(),await G(),(()=>{const e=l.value.find((e=>e.id==a));if(!e)return;u.value=e,JSON.parse(u.value.data).forEach((e=>{var l,a;const{shape:t}=e;"edge"==t?null==(l=o.value)||l.addEdge(e):null==(a=o.value)||a.addNode(e)}))})()};return q((()=>{de()})),(e,l)=>{const a=y,o=V,f=_,k=x,z=M,S=g,q=C;return A(),L("div",gl,[P(S,null,{default:W((()=>[T("div",{class:"stencil",ref_key:"stencil",ref:r},null,512),P(q,{class:"split",size:h.value,"onUpdate:size":l[2]||(l[2]=e=>h.value=e),max:.73,min:.6},{first:W((()=>[T("div",{class:"container",ref_key:"container",ref:t},null,512)])),second:W((()=>[T("div",bl,[P(S,{class:"property"},{default:W((()=>[P(z,{"active-key":c.value,"onUpdate:activeKey":l[1]||(l[1]=e=>c.value=e)},{default:W((()=>[P(f,{key:"global",title:"全局属性"},{default:W((()=>[P(o,{style:{height:"83vh",overflow:"auto"}},{default:W((()=>[P(B(fl),{property:v.value,ref_key:"propertyForm",ref:p},null,8,["property"]),T("div",wl,[P(a,{type:"primary",onClick:ue},{icon:W((()=>[P(B(b))])),default:W((()=>[E(" 保存设置 ")])),_:1})])])),_:1})])),_:1}),P(f,{key:"node",title:"节点属性"},{default:W((()=>[H(P(o,{style:{height:"82vh",overflow:"auto"}},{default:W((()=>[H(P(B(Te),{property:i.value,onChange:j},null,8,["property"]),[[K,"node"==n.value]]),H(P(B(Ce),{property:s.value,onChange:U},null,8,["property"]),[[K,"line"==n.value]])])),_:1},512),[[K,d.value]]),H(T("div",null,[P(k,{description:"暂无节点信息"})],512),[[K,!d.value]])])),_:1}),P(f,{key:"draw",title:"绘图信息"},{default:W((()=>[P(B(ke),{model:u.value,"onUpdate:model":l[0]||(l[0]=e=>u.value=e),onChange:N,ref_key:"drawForm",ref:m},null,8,["model"]),T("div",kl,[P(a,{type:"primary",onClick:re},{icon:W((()=>[P(B(b))])),default:W((()=>[E(" 保存作图 ")])),_:1}),P(a,{onClick:F},{icon:W((()=>[P(B(w))])),default:W((()=>[E(" 导出图片 ")])),_:1})])])),_:1})])),_:1},8,["active-key"])])),_:1})])])),_:1},8,["size"])])),_:1})])}}});export{yl as default};
