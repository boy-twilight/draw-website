import{l as e,F as l,S as a,m as o,n as t,o as r,p as u,q as d,r as n,R as i,s,t as c,u as v,v as p,w as m,x as h,g,y as f,B as b,z as y,D as w,C as V,E as k,G as _,H as x,J as M,K as C,N as z,O as j}from"../@arco-design/@arco-design.a99e9319.js";import{e as U,t as S,r as A,w as N,k as T,l as W,m as P,v as H,n as B,$ as E,y as F,z as L,p as I,M as K,N as q,o as G,C as D}from"../@vue/@vue.39664cb3.js";import{T as O,S as J,a as R,K as $,C as Q,H as X,E as Y,b as Z,G as ee,c as le,d as ae}from"../@antv/@antv.354d31c8.js";import{b as oe}from"../vue-router/vue-router.5c0bd928.js";import{c as te,u as re,l as ue,f as de}from"../data/data.79d23b95.js";import{e as ne,n as ie}from"../lodash-es/lodash-es.5d7a2e52.js";import{a as se}from"../vue3-colorpicker/vue3-colorpicker.88804826.js";import{s as ce}from"../pinia/pinia.a4fb185b.js";import{v as ve}from"../uuid/uuid.ba5d26a9.js";import"../resize-observer-polyfill/resize-observer-polyfill.ad543aa3.js";import"../compute-scroll-into-view/compute-scroll-into-view.2962e95c.js";import"../b-tween/b-tween.5055d79e.js";import"../dayjs/dayjs.37468663.js";import"../crypto-js/crypto-js.930e5814.js";import"../scroll-into-view-if-needed/scroll-into-view-if-needed.f139de06.js";import"../b-validate/b-validate.457088db.js";import"../number-precision/number-precision.d9b928a1.js";import"../mousetrap/mousetrap.890cce9b.js";import"../lyc-storage/lyc-storage.5b5a1c46.js";import"../../static/index-85b6ee5d.js";import"../nprogress/nprogress.02fc88c0.js";import"../@vueuse/@vueuse.11702cf4.js";import"../tinycolor2/tinycolor2.2b8234f4.js";import"../gradient-parser/gradient-parser.96402e16.js";import"../vue-types/vue-types.52f94848.js";import"../is-plain-object/is-plain-object.32bf4cc1.js";import"../@aesoper/@aesoper.4b44138d.js";import"../@popperjs/@popperjs.396dda61.js";const pe=(e,l)=>{for(let a=0;a<e.length;a++)e[a].style.visibility=l?"visible":"hidden"},me=e=>"none"!=e?{name:e,width:12,height:8}:null,he=e=>{const l=new Map([["edge-editor",{name:"edge-editor",args:{attrs:{text:{fontSize:15}}}}],["vertices",{name:"vertices"}],["segments",{name:"segments"}],["boundary",{name:"boundary",args:{padding:15}}],["button-remove",{name:"button-remove",args:{distance:"50%"}}],["source-arrowhead",{name:"source-arrowhead"}],["target-arrowhead",{name:"target-arrowhead"}]]);return e.map((e=>l.get(e)))},ge=e=>{let l={};return l="rounded"==e?{radius:8}:{radius:8,type:"arc",size:8},l},fe=e=>({position:e,attrs:{circle:{r:4.5,magnet:!0,stroke:"#000",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}}),be=e=>{const{width:l,height:a,shape:o}=e;return{inherit:o,width:l,height:a,attrs:{body:{strokeWidth:1.5,stroke:"#000000",fill:"#ffffff"},text:{fontSize:12,fill:"#262626",textAnchor:"middle",textVerticalAnchor:"middle",lineHeight:12},label:{textWrap:{width:"90%",height:"90%",ellipsis:!0,breakWord:!0}}},ports:{groups:{top:fe("top"),right:fe("right"),bottom:fe("bottom"),left:fe("left")}}}},ye=e=>(e||["top","bottom","left","right"]).map((e=>({group:e}))),we=(e,l)=>{let{refPoints:a,width:o,height:t,port:r}=l;return o=o||33,t=t||18,e.createNode({shape:"custom-polygon",width:o,height:t,attrs:{body:{refPoints:a}},ports:{items:ye(r)}})},Ve=(e,l)=>{const{rx:a,ry:o,port:t}=l;return e.createNode({shape:"custom-rect",attrs:{body:{rx:a,ry:o}},ports:{items:ye(t)}})},ke=e=>{const l=Ve(e,{rx:0,ry:0}),a=Ve(e,{rx:6,ry:6}),o=Ve(e,{rx:10,ry:13}),t=((e,l)=>e.createNode({shape:"custom-ellipse",ports:{items:ye(l)}}))(e),r=((e,l)=>e.createNode({shape:"custom-circle",ports:{items:ye(l)}}))(e);return[l,a,o,t,r,we(e,{refPoints:"10,0 40,0 30,20 0,20"}),we(e,{refPoints:"0,10 10,0 20,10 10,20"}),we(e,{height:25,width:25,refPoints:"0.5,0 0.61,0.35 1,0.35 0.68,0.57 0.79,0.91 0.5,0.75 0.21,0.91 0.32,0.57 0,0.35 0.39,0.35"}),we(e,{refPoints:"0,0 0,1 1,1",port:["left","bottom"]}),we(e,{height:22,width:25,refPoints:"0.5,0 1,1 0,1"}),we(e,{height:25,refPoints:"0.5,0 1,0.38 0.82,1 0.18,1 0,0.38"}),we(e,{height:28,width:28,refPoints:"0.5,0 1,0.25 1,0.75 0.5,1 0,0.75 0,0.25"}),we(e,{height:33,refPoints:"0.5,0 0.85,0.15 1,0.5 0.85,0.85 0.5,1 0.15,0.85 0,0.5 0.15,0.15"})]},_e=U({__name:"index",props:{model:{}},emits:["change"],setup(r,{expose:u,emit:d}){const n=r,i=d,{model:s}=S(n),c=A(s.value),v={name:{message:"绘图名称必须填写",required:!0,type:"string"},desc:{message:"绘图备注必须填写",required:!0,type:"string"},exportType:{message:"导出图片的类型必须选择",required:!0,type:"string"}},p=[{label:"png格式",value:"png"},{label:"jpeg格式",value:"jpeg"},{label:"svg格式",value:"svg"}],m=A();return N(s,(e=>{c.value=ne(e)}),{deep:!0}),u({validate:()=>m.value.validate()}),(r,u)=>{const d=e,n=l,s=a,h=o,g=t;return T(),W(g,{model:c.value,rules:v,"label-align":"left","auto-label-width":"",ref_key:"formIns",ref:m},{default:P((()=>[H(n,{label:"名称",field:"name","validate-trigger":"blur"},{default:P((()=>[H(d,{modelValue:c.value.name,"onUpdate:modelValue":u[0]||(u[0]=e=>c.value.name=e),placeholder:"请输入绘图名称",onChange:u[1]||(u[1]=e=>i("change","name",c.value.name))},null,8,["modelValue"])])),_:1}),H(n,{label:"导出类型",field:"exportType","validate-trigger":"blur"},{default:P((()=>[H(s,{modelValue:c.value.exportType,"onUpdate:modelValue":u[2]||(u[2]=e=>c.value.exportType=e),options:p,onChange:u[3]||(u[3]=e=>i("change","exportType",c.value.exportType)),placeholder:"请选择导出图片的类型"},null,8,["modelValue"])])),_:1}),H(n,{label:"备注",field:"desc","validate-trigger":"blur"},{default:P((()=>[H(h,{modelValue:c.value.desc,"onUpdate:modelValue":u[4]||(u[4]=e=>c.value.desc=e),placeholder:"请输入此次绘图的备注","auto-size":{minRows:5},onChange:u[5]||(u[5]=e=>i("change","desc",c.value.desc))},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])}}}),xe={class:"slider-container"},Me={class:"color"},Ce=B("span",{class:"iconfont line-color"},"",-1),ze={class:"slider-container"},je={class:"slider-container"},Ue=U({__name:"index",props:{property:{}},emits:["change"],setup(e,{emit:a}){const o=e,d=a,{property:n}=S(o),i=A(n.value);return N(n,(e=>{i.value=ne(e)}),{deep:!0}),N(i,(e=>{ie(e,n.value)||d("change",e)}),{deep:!0}),(e,a)=>{const o=r,d=l,s=u,c=t;return T(),W(c,{model:E(n),"label-align":"left","auto-label-width":""},{default:P((()=>[H(d,{label:"线条宽度",field:"strokeWidth"},{default:P((()=>[B("div",xe,[H(o,{modelValue:i.value.strokeWidth,"onUpdate:modelValue":a[0]||(a[0]=e=>i.value.strokeWidth=e),modelModifiers:{lazy:!0},min:1,max:100,"show-input":""},null,8,["modelValue"])])])),_:1}),H(d,{label:"线条颜色",field:"strokeColor"},{default:P((()=>[B("div",Me,[H(E(se),{pureColor:i.value.strokeColor,"onUpdate:pureColor":a[1]||(a[1]=e=>i.value.strokeColor=e),format:"hex6"},null,8,["pureColor"]),H(s,null,{icon:P((()=>[Ce])),default:P((()=>[F(" "+L(i.value.strokeColor),1)])),_:1})])])),_:1}),H(d,{label:"箭头宽度",field:"markerWidth"},{default:P((()=>[B("div",ze,[H(o,{modelValue:i.value.markerWidth,"onUpdate:modelValue":a[2]||(a[2]=e=>i.value.markerWidth=e),modelModifiers:{lazy:!0},min:5,max:100,"show-input":""},null,8,["modelValue"])])])),_:1}),H(d,{label:"箭头高度",field:"markerHeight"},{default:P((()=>[B("div",je,[H(o,{modelValue:i.value.markerHeight,"onUpdate:modelValue":a[3]||(a[3]=e=>i.value.markerHeight=e),modelModifiers:{lazy:!0},min:5,max:100,"show-input":""},null,8,["modelValue"])])])),_:1})])),_:1},8,["model"])}}}),Se={class:"slider-container"},Ae={class:"slider-container"},Ne={class:"color"},Te={class:"slider-container"},We={class:"color"},Pe={class:"slider-container"},He={class:"slider-container"},Be={class:"color"},Ee=B("span",{class:"iconfont line-color"},"",-1),Fe=U({__name:"index",props:{property:{}},emits:["change"],setup(e,{emit:a}){const o=e,c=a,{property:v}=S(o),p=A(v.value);return N(v,(e=>{p.value=ne(e)}),{deep:!0}),N(p,(e=>{ie(v.value,e)||c("change",e)}),{deep:!0}),(e,a)=>{const o=r,c=l,m=u,h=i,g=s,f=t;return T(),W(f,{model:E(v),"label-align":"left","auto-label-width":""},{default:P((()=>[H(c,{label:"高度",field:"height"},{default:P((()=>[B("div",Se,[H(o,{modelValue:p.value.height,"onUpdate:modelValue":a[0]||(a[0]=e=>p.value.height=e),modelModifiers:{lazy:!0},min:10,max:1e3,"show-input":""},null,8,["modelValue"])])])),_:1}),H(c,{label:"宽度",field:"width"},{default:P((()=>[B("div",Ae,[H(o,{modelValue:p.value.width,"onUpdate:modelValue":a[1]||(a[1]=e=>p.value.width=e),modelModifiers:{lazy:!0},min:10,max:1e3,"show-input":""},null,8,["modelValue"])])])),_:1}),H(c,{label:"填充颜色",field:"background"},{default:P((()=>[B("div",Ne,[H(E(se),{pureColor:p.value.background,"onUpdate:pureColor":a[2]||(a[2]=e=>p.value.background=e),format:"hex6"},null,8,["pureColor"]),H(m,null,{icon:P((()=>[H(E(d),{size:16})])),default:P((()=>[F(" "+L(p.value.background),1)])),_:1})])])),_:1}),H(c,{label:"字体大小",field:"fontSize"},{default:P((()=>[B("div",Te,[H(o,{modelValue:p.value.fontSize,"onUpdate:modelValue":a[3]||(a[3]=e=>p.value.fontSize=e),modelModifiers:{lazy:!0},min:10,max:100,"show-input":""},null,8,["modelValue"])])])),_:1}),H(c,{label:"字体颜色",field:"fontColor"},{default:P((()=>[B("div",We,[H(E(se),{pureColor:p.value.fontColor,"onUpdate:pureColor":a[4]||(a[4]=e=>p.value.fontColor=e),format:"hex6"},null,8,["pureColor"]),H(m,null,{icon:P((()=>[H(E(n),{size:15})])),default:P((()=>[F(" "+L(p.value.fontColor),1)])),_:1})])])),_:1}),H(c,{label:"水平对齐",field:"textAnchor"},{default:P((()=>[H(g,{modelValue:p.value.textAnchor,"onUpdate:modelValue":a[5]||(a[5]=e=>p.value.textAnchor=e),type:"button",size:"small"},{default:P((()=>[H(h,{value:"end"},{default:P((()=>[F("向左")])),_:1}),H(h,{value:"middle"},{default:P((()=>[F("两端")])),_:1}),H(h,{value:"start"},{default:P((()=>[F("向右")])),_:1})])),_:1},8,["modelValue"])])),_:1}),H(c,{label:"垂直对齐",field:"textVerticalAnchor"},{default:P((()=>[H(g,{modelValue:p.value.textVerticalAnchor,"onUpdate:modelValue":a[6]||(a[6]=e=>p.value.textVerticalAnchor=e),type:"button",size:"small"},{default:P((()=>[H(h,{value:"bottom"},{default:P((()=>[F("顶部")])),_:1}),H(h,{value:"middle"},{default:P((()=>[F("居中")])),_:1}),H(h,{value:"top"},{default:P((()=>[F("底部")])),_:1})])),_:1},8,["modelValue"])])),_:1}),H(c,{label:"行高",field:"lineHeight"},{default:P((()=>[B("div",Pe,[H(o,{modelValue:p.value.lineHeight,"onUpdate:modelValue":a[7]||(a[7]=e=>p.value.lineHeight=e),modelModifiers:{lazy:!0},min:10,max:100,"show-input":""},null,8,["modelValue"])])])),_:1}),H(c,{label:"线条宽度",field:"borderSize"},{default:P((()=>[B("div",He,[H(o,{modelValue:p.value.borderSize,"onUpdate:modelValue":a[8]||(a[8]=e=>p.value.borderSize=e),modelModifiers:{lazy:!0},min:1,max:100,"show-input":""},null,8,["modelValue"])])])),_:1}),H(c,{label:"线条颜色",field:"borderColor"},{default:P((()=>[B("div",Be,[H(E(se),{pureColor:p.value.borderColor,"onUpdate:pureColor":a[9]||(a[9]=e=>p.value.borderColor=e),format:"hex6"},null,8,["pureColor"]),H(m,null,{icon:P((()=>[Ee])),default:P((()=>[F(" "+L(p.value.borderColor),1)])),_:1})])])),_:1})])),_:1},8,["model"])}}}),Le=U({__name:"index",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(e,{emit:l}){const a=l,o=e=>{a("update:modelValue",e)};return(e,l)=>{const a=p;return T(),I("div",null,[H(a,{"model-value":e.modelValue,"checked-value":!0,"unchecked-value":!1,"checked-text":"开启","unchecked-text":"关闭",onChange:o},{"checked-icon":P((()=>[H(E(c))])),"unchecked-icon":P((()=>[H(E(v))])),default:P((()=>[F("> "),F("> ")])),_:1},8,["model-value"])])}}}),Ie=B("span",{class:"title"},"画布属性：",-1),Ke={class:"upload"},qe={class:"slider-container"},Ge={class:"color"},De={class:"slider-container"},Oe={class:"label"},Je=B("span",null,"节点嵌套",-1),Re={class:"label"},$e=B("span",null,"空白连接",-1),Qe={class:"label"},Xe=B("span",null,"空白连接",-1),Ye={class:"label"},Ze=B("span",null,"循环连接",-1),el={class:"label"},ll=B("span",null,"多边连接",-1),al={class:"label"},ol=B("span",null,"连接高光",-1),tl={class:"label"},rl=B("span",null,"节点拖拽",-1),ul={class:"label"},dl=B("span",null,"边拖拽",-1),nl={class:"label"},il=B("span",null,"边标签拖拽",-1),sl={class:"label"},cl=B("span",null,"箭头拖拽",-1),vl=B("span",{class:"title"},"线条属性：",-1),pl={class:"label"},ml=B("span",null,"路由模式",-1),hl={class:"label"},gl=B("span",null,"连接器",-1),fl={class:"label"},bl=B("span",null,"自动吸附",-1),yl={class:"slider-container"},wl={class:"label"},Vl=B("span",null,"边上工具",-1),kl=U({__name:"index",props:{property:{}},setup(e,{expose:o}){const n=e,{property:c}=S(n),v=A(c.value),p=[{label:"没有箭头",value:"none"},{label:"实心箭头",value:"block"},{label:"经典箭头",value:"classic"},{label:"菱形箭头",value:"diamond"},{label:"圆形箭头",value:"circle"},{label:"圆形和加号箭头",value:"circlePlus"},{label:"椭圆箭头",value:"ellipse"},{label:"交叉箭头",value:"cross"},{label:"async",value:"async"}],V=[{label:"内置路由",value:"normal"},{label:"正交路由",value:"orth"},{label:"受限正交路由",value:"oneSide"},{label:"智能正交路由",value:"manhattan"},{label:"智能地铁线路由",value:"metro"},{label:"实体关系路由",value:"er"}],k=[{label:"简单连接器",value:"normal"},{label:"平滑连接器",value:"smooth"},{label:"圆角连接器",value:"rounded"},{label:"跳线连接器",value:"jumpover"}],_=[{label:"文本编辑工具",value:"edge-editor"},{label:"起点修改工具",value:"source-arrowhead"},{label:"终点修改工具",value:"target-arrowhead"},{label:"路径点工具",value:"vertices"},{label:"矩形框工具",value:"boundary"},{label:"删除工具",value:"button-remove"},{label:"线段工具",value:"segments"}],x=()=>{const e=document.createElement("input");e.type="file",e.accept=".png,.jpeg,.jpg,.gif,.bmp",e.style.display="none",e.onchange=async e=>{const l=e.target.files;if(l.length<=0)return;const a=l[0];if(!/\.(jpg|jpeg|png|gif|bmp)$/i.test(a.name))return g.error("请上传图像文件");const o=await te(a,4320,7680,.6);v.value.bgImage=o},document.body.appendChild(e),e.click(),document.body.removeChild(e)};return o({getFormValue:()=>v.value}),(e,o)=>{const n=i,g=s,M=l,C=f,z=b,j=r,U=u,S=y,A=a,N=w,I=t;return T(),W(I,{model:E(c),"label-align":"left","auto-label-width":""},{default:P((()=>[Ie,H(M,{label:"背景模式",field:"bgMode"},{default:P((()=>[H(g,{modelValue:v.value.bgMode,"onUpdate:modelValue":o[0]||(o[0]=e=>v.value.bgMode=e)},{default:P((()=>[H(n,{value:"color"},{default:P((()=>[F("纯色背景")])),_:1}),H(n,{value:"image"},{default:P((()=>[F("图像背景")])),_:1})])),_:1},8,["modelValue"])])),_:1}),K(H(M,{label:"背景图像",field:"bgImage"},{default:P((()=>[B("div",Ke,[H(C,{width:"150",height:"150",src:v.value.bgImage,style:{cursor:"pointer"}},null,8,["src"]),H(z,{onClick:x},{icon:P((()=>[H(E(m))])),default:P((()=>[F(" 上传 ")])),_:1})])])),_:1},512),[[q,"image"==v.value.bgMode]]),K(H(M,{label:"背景透明度",field:"opacity"},{default:P((()=>[B("div",qe,[H(j,{modelValue:v.value.opacity,"onUpdate:modelValue":o[1]||(o[1]=e=>v.value.opacity=e),modelModifiers:{lazy:!0},min:.1,max:1,step:.1,"show-input":""},null,8,["modelValue"])])])),_:1},512),[[q,"image"==v.value.bgMode]]),H(M,{label:"背景色",field:"background"},{default:P((()=>[B("div",Ge,[H(E(se),{pureColor:v.value.background,"onUpdate:pureColor":o[2]||(o[2]=e=>v.value.background=e),format:"hex6"},null,8,["pureColor"]),H(U,null,{icon:P((()=>[H(E(d),{size:16})])),default:P((()=>[F(" "+L(v.value.background),1)])),_:1})])])),_:1}),H(M,{label:"画布缩放",field:"mousewheel"},{default:P((()=>[H(Le,{modelValue:v.value.mousewheel,"onUpdate:modelValue":o[3]||(o[3]=e=>v.value.mousewheel=e)},null,8,["modelValue"])])),_:1}),K(H(M,{label:"缩放倍率",field:"scale"},{default:P((()=>[B("div",De,[H(j,{modelValue:v.value.scale,"onUpdate:modelValue":o[4]||(o[4]=e=>v.value.scale=e),min:.1,max:5,step:.1,range:"","show-input":""},null,8,["modelValue"])])])),_:1},512),[[q,v.value.mousewheel]]),H(M,{label:"画布平移",field:"panning"},{default:P((()=>[H(Le,{modelValue:v.value.panning,"onUpdate:modelValue":o[5]||(o[5]=e=>v.value.panning=e)},null,8,["modelValue"])])),_:1}),H(M,{field:"embedding"},{label:P((()=>[B("div",Oe,[Je,H(S,{content:"是否允许一个节点在另外一个节点内部成为子节点，默认为true。"},{default:P((()=>[H(E(h))])),_:1})])])),default:P((()=>[H(Le,{modelValue:v.value.embedding,"onUpdate:modelValue":o[6]||(o[6]=e=>v.value.embedding=e)},null,8,["modelValue"])])),_:1}),H(M,{field:"allowBlank"},{label:P((()=>[B("div",Re,[$e,H(S,{content:"是否允许连接到画布空白位置的点，默认为true。"},{default:P((()=>[H(E(h))])),_:1})])])),default:P((()=>[H(Le,{modelValue:v.value.allowBlank,"onUpdate:modelValue":o[7]||(o[7]=e=>v.value.allowBlank=e)},null,8,["modelValue"])])),_:1}),H(M,{field:"allowBlank"},{label:P((()=>[B("div",Qe,[Xe,H(S,{content:"是否允许连接到画布空白位置的点，默认为true。"},{default:P((()=>[H(E(h))])),_:1})])])),default:P((()=>[H(Le,{modelValue:v.value.allowBlank,"onUpdate:modelValue":o[8]||(o[8]=e=>v.value.allowBlank=e)},null,8,["modelValue"])])),_:1}),H(M,{field:"allowLoop"},{label:P((()=>[B("div",Ye,[Ze,H(S,{content:"是否允许创建循环连线，即边的起始节点和终止节点为同一节点，默认为true。"},{default:P((()=>[H(E(h))])),_:1})])])),default:P((()=>[H(Le,{modelValue:v.value.allowLoop,"onUpdate:modelValue":o[9]||(o[9]=e=>v.value.allowLoop=e)},null,8,["modelValue"])])),_:1}),H(M,{field:"allowMulti"},{label:P((()=>[B("div",el,[ll,H(S,{content:"是否允许在相同的起始节点和终止之间创建多条边，默认为true。\r\n            当设置为 false 时，在起始和终止节点之间只允许创建一条边。"},{default:P((()=>[H(E(h))])),_:1})])])),default:P((()=>[H(Le,{modelValue:v.value.allowMulti,"onUpdate:modelValue":o[10]||(o[10]=e=>v.value.allowMulti=e)},null,8,["modelValue"])])),_:1}),H(M,{field:"highlight"},{label:P((()=>[B("div",al,[ol,H(S,{content:"拖动边时，是否高亮显示所有可用的连接桩或节点，默认值为false。"},{default:P((()=>[H(E(h))])),_:1})])])),default:P((()=>[H(Le,{modelValue:v.value.highlight,"onUpdate:modelValue":o[11]||(o[11]=e=>v.value.highlight=e)},null,8,["modelValue"])])),_:1}),H(M,{field:"nodeMovable"},{label:P((()=>[B("div",tl,[rl,H(S,{content:"节点是否可以被移动，默认值为true"},{default:P((()=>[H(E(h))])),_:1})])])),default:P((()=>[H(Le,{modelValue:v.value.nodeMovable,"onUpdate:modelValue":o[12]||(o[12]=e=>v.value.nodeMovable=e)},null,8,["modelValue"])])),_:1}),H(M,{field:"edgeMovable"},{label:P((()=>[B("div",ul,[dl,H(S,{content:"边是否可以被移动，默认值为true。"},{default:P((()=>[H(E(h))])),_:1})])])),default:P((()=>[H(Le,{modelValue:v.value.edgeMovable,"onUpdate:modelValue":o[13]||(o[13]=e=>v.value.edgeMovable=e)},null,8,["modelValue"])])),_:1}),H(M,{field:"edgeMovable"},{label:P((()=>[B("div",nl,[il,H(S,{content:"边的标签是否可以被移动，默认值为true。"},{default:P((()=>[H(E(h))])),_:1})])])),default:P((()=>[H(Le,{modelValue:v.value.edgeLabelMovable,"onUpdate:modelValue":o[14]||(o[14]=e=>v.value.edgeLabelMovable=e)},null,8,["modelValue"])])),_:1}),H(M,{field:"arrowheadMovable"},{label:P((()=>[B("div",sl,[cl,H(S,{content:"边的起始/终止箭头是否可以被移动，默认值为true。"},{default:P((()=>[H(E(h))])),_:1})])])),default:P((()=>[H(Le,{modelValue:v.value.arrowheadMovable,"onUpdate:modelValue":o[15]||(o[15]=e=>v.value.arrowheadMovable=e)},null,8,["modelValue"])])),_:1}),vl,H(M,{label:"线条类型",field:"lineType"},{default:P((()=>[H(g,{modelValue:v.value.lineType,"onUpdate:modelValue":o[16]||(o[16]=e=>v.value.lineType=e)},{default:P((()=>[H(n,{value:""},{default:P((()=>[F("实线")])),_:1}),H(n,{value:"7,7"},{default:P((()=>[F("虚线")])),_:1})])),_:1},8,["modelValue"])])),_:1}),H(M,{label:"起点箭头",field:"sourceMarker"},{default:P((()=>[H(A,{modelValue:v.value.sourceMarker,"onUpdate:modelValue":o[17]||(o[17]=e=>v.value.sourceMarker=e),placeholder:"请选择起点箭头类型",options:p},null,8,["modelValue"])])),_:1}),H(M,{label:"终点箭头",field:"targetMarker"},{default:P((()=>[H(A,{modelValue:v.value.targetMarker,"onUpdate:modelValue":o[18]||(o[18]=e=>v.value.targetMarker=e),placeholder:"请选择终点箭头类型",options:p},null,8,["modelValue"])])),_:1}),H(M,{field:"router"},{label:P((()=>[B("div",pl,[ml,H(S,{content:"路由将边的路径点 vertices 做进一步转换处理，并在必要时添加额外的点，然后返回处理后的点（不包含边的起点和终点）。例如，经过 orth 路由处理后，边的每一条线段都是水平或垂直的正交线段，默认为\t智能正交路由。"},{default:P((()=>[H(E(h))])),_:1})])])),default:P((()=>[H(A,{modelValue:v.value.router,"onUpdate:modelValue":o[19]||(o[19]=e=>v.value.router=e),placeholder:"请选择路由模式",options:V},null,8,["modelValue"])])),_:1}),H(M,{field:"connector"},{label:P((()=>[B("div",hl,[gl,H(S,{content:"连接起点、终点、路有点的连线类型，默认值为圆角连接器"},{default:P((()=>[H(E(h))])),_:1})])])),default:P((()=>[H(A,{modelValue:v.value.connector,"onUpdate:modelValue":o[20]||(o[20]=e=>v.value.connector=e),placeholder:"请选择连接器",options:k},null,8,["modelValue"])])),_:1}),H(M,{field:"snap"},{label:P((()=>[B("div",fl,[bl,H(S,{content:"开启和关闭连线过程中自动吸附，数值大小代表吸附距离，默认值是20px。"},{default:P((()=>[H(E(h))])),_:1})])])),default:P((()=>[B("div",yl,[H(j,{modelValue:v.value.snap,"onUpdate:modelValue":o[21]||(o[21]=e=>v.value.snap=e),modelModifiers:{lazy:!0},min:1,max:100,"show-input":""},null,8,["modelValue"])])])),_:1}),H(M,{field:"lineTools"},{label:P((()=>[B("div",wl,[Vl,H(S,{content:"开启边的一些小工具便于操作，默认有边上编辑工具。"},{default:P((()=>[H(E(h))])),_:1})])])),default:P((()=>[H(N,{modelValue:v.value.lineTools,"onUpdate:modelValue":o[22]||(o[22]=e=>v.value.lineTools=e),options:_},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])}}}),_l={class:"draw"},xl={class:"operation"},Ml={class:"footer"},Cl={class:"footer"},zl=U({__name:"index",setup(e){const{userData:l}=ce(re()),a=oe().query.id+"",o=A(),t=A(),r=A(),u=A({id:"",name:"",desc:"",data:"",exportType:"png",createTime:"",updateTime:""}),d=A(""),n=A("node"),i=A({width:0,height:0,fontColor:"",fontSize:0,lineHeight:0,background:"",borderColor:"",borderSize:0,textAnchor:"",textVerticalAnchor:""}),s=A({strokeColor:"",strokeWidth:0,markerHeight:0,markerWidth:0}),c=A("global"),v=A(ue.get("setting")||{bgImage:"",bgMode:"color",opacity:.6,background:"#ffffff",mousewheel:!0,scale:[.3,3],panning:!0,embedding:!0,allowBlank:!0,allowLoop:!0,allowMulti:!0,allowPort:!0,highlight:!1,allowEdge:!0,allowNode:!0,nodeMovable:!0,edgeMovable:!0,edgeLabelMovable:!0,arrowheadMovable:!0,vertexMovable:!0,vertexAddable:!0,vertexDeletable:!0,sourceMarker:"none",targetMarker:"block",router:"manhattan",connector:"rounded",lineType:"",snap:20,lineTools:["edge-editor"],nodeTools:["node-editor"]}),p=A(),m=A(),h=A(.73),f=e=>{d.value=e.id,n.value="node";const l=e.getAttrs(),{width:a,height:o}=e.getProp("size"),{body:{fill:t,stroke:r,strokeWidth:u},text:{fill:s,fontSize:c,textAnchor:v,textVerticalAnchor:p,lineHeight:m}}=l;i.value={width:a,height:o,fontSize:Number(c),fontColor:String(s),borderColor:String(r),borderSize:Number(u),background:String(t),textAnchor:String(v),lineHeight:Number(m),textVerticalAnchor:String(p)}},y=e=>{d.value=e.id,n.value="line";const l=e.getAttrs(),{line:{stroke:a,strokeWidth:o,targetMarker:t}}=l,{height:r,width:u}=Object(t);s.value={strokeWidth:Number(o),strokeColor:String(a),markerHeight:r||0,markerWidth:u||0}},w=e=>{const l=o.value.getCellById(d.value),{background:a,borderColor:t,borderSize:r,fontColor:u,fontSize:n,textAnchor:s,textVerticalAnchor:c,height:v,width:p,lineHeight:m}=e;l.setAttrs({body:{fill:a,stroke:t,strokeWidth:r},text:{fill:u,fontSize:n,textAnchor:s,textVerticalAnchor:c,lineHeight:m}}),l.setProp("size",{width:p,height:v}),i.value=e},U=e=>{const l=o.value.getCellById(d.value),{markerWidth:a,markerHeight:t,strokeWidth:r,strokeColor:u}=e;l.setAttrs({line:{stroke:u,strokeWidth:r,sourceMarker:{height:t,width:a},targetMarker:{height:t,width:a}}}),s.value=e},S=(e,l)=>{u.value[e]=l},N=()=>{const{exportType:e}=u.value;"png"==e?o.value.exportPNG():"jpeg"==e?o.value.exportJPEG():o.value.exportSVG()},W=async()=>{var e;if(await(null==(e=p.value)?void 0:e.validate()))return c.value="draw",g.error("请填写完整绘图名称和绘图备注后，在进行保存！");u.value.data=JSON.stringify(o.value.toJSON().cells);const t=l.value.findIndex((e=>e.id==a));if(-1!=t)u.value.updateTime=de(new Date),l.value[t]=u.value,g.success("修改保存成功！");else{u.value.id=ve();const e=new Date;u.value.createTime=de(e),u.value.updateTime=de(e),l.value.push(u.value),g.success("新增保存成功！")}},L=()=>{ue.set("setting",m.value.getFormValue()),location.reload()},te=async()=>{var e,s;ee.registerNode("custom-rect",be({shape:"rect",width:33,height:18}),!0),ee.registerNode("custom-polygon",be({shape:"polygon",width:33,height:18}),!0),ee.registerNode("custom-circle",be({shape:"circle",width:23,height:23}),!0),ee.registerNode("custom-ellipse",be({shape:"ellipse",width:33,height:18}),!0),o.value=(e=t.value,new ee({container:e,background:{color:"color"==v.value.bgMode?"transparent":v.value.background,image:"color"==v.value.bgMode?"":v.value.bgImage,opacity:v.value.opacity,position:"center"},grid:{type:"doubleMesh",size:12,visible:!0,args:[{color:"#eee",thickness:1},{color:"#ddd",thickness:1,factor:4}]},embedding:v.value.embedding,mousewheel:{enabled:v.value.mousewheel,zoomAtMousePosition:!0,modifiers:["ctrl","meta"],minScale:v.value.scale[0],maxScale:v.value.scale[1]},interacting:{edgeLabelMovable:v.value.edgeLabelMovable,edgeMovable:v.value.edgeMovable,arrowheadMovable:v.value.arrowheadMovable,nodeMovable:v.value.nodeMovable},connecting:{router:v.value.router,anchor:"center",connectionPoint:"anchor",connector:{name:v.value.connector,args:ge(v.value.connector)},snap:{radius:v.value.snap},allowBlank:v.value.allowBlank,allowEdge:v.value.allowEdge,allowPort:v.value.allowPort,allowLoop:v.value.allowLoop,allowMulti:v.value.allowMulti,allowNode:v.value.allowNode,highlight:v.value.highlight,createEdge(){const e=new le({attrs:{line:{stroke:"#000000",strokeWidth:2,sourceMarker:me(v.value.sourceMarker),targetMarker:me(v.value.targetMarker),"stroke-dasharray":v.value.lineType}},tools:he(v.value.lineTools),zIndex:0});return d.value=e.id,c.value="node",n.value="line",y(e),e},validateConnection:({targetMagnet:e})=>!!e},highlighting:{magnetAdsorbed:{name:"stroke",args:{attrs:{fill:"#5F95FF",stroke:"#5F95FF",strokeWidth:5}}}}})),(e=>{e.use(new O({resizing:{enabled:!0,preserveAspectRatio:!0},rotating:{enabled:!0}})).use(new J({rubberband:!0,showNodeSelectionBox:!0,showEdgeSelectionBox:!0})).use(new R({className:"snapline"})).use(new $).use(new Q).use(new X).use(new Y).use(new Z({modifiers:["ctrl","meta"],pannable:!0})),e.lockScroller()})(o.value),(e=>{var l;const a=new ae({title:"流程图基础图形",target:e,stencilGraphWidth:200,stencilGraphHeight:250,collapsable:!1,groups:[{title:"基础图形",name:"node"}],layoutOptions:{columns:3,columnWidth:53,rowHeight:45},getDropNode(e){const l=e.size(),a=e.clone().size({height:2*l.height,width:2*l.width});return a.addTools([{name:"node-editor",args:{attrs:{text:{fontSize:15}}}}]),c.value="node",f(a),a}});a.load(ke(e),"node"),null==(l=r.value)||l.appendChild(a.container)})(o.value),(e=>{e.bindKey(["meta+c","ctrl+c"],(()=>{const l=e.getSelectedCells();return l.length&&e.copy(l),!1})),e.bindKey(["meta+x","ctrl+x"],(()=>{const l=e.getSelectedCells();return l.length&&e.cut(l),!1})),e.bindKey(["meta+v","ctrl+v"],(()=>{if(!e.isClipboardEmpty()){const l=e.paste({offset:32});e.cleanSelection(),e.select(l)}return!1})),e.bindKey(["meta+z","ctrl+z"],(()=>(e.canUndo()&&e.undo(),!1))),e.bindKey(["meta+shift+z","ctrl+shift+z"],(()=>(e.canRedo()&&e.redo(),!1))),e.bindKey(["meta+a","ctrl+a"],(()=>{const l=e.getNodes();l&&e.select(l)})),e.bindKey("backspace",(()=>{const l=e.getSelectedCells();l.length&&e.removeCells(l)}))})(o.value),(s=o.value).on("node:mouseenter",(()=>{const e=t.value.querySelectorAll(".x6-port-body");pe(e,!0)})),s.on("node:mouseleave",(()=>{const e=t.value.querySelectorAll(".x6-port-body");pe(e,!1)})),s.on("node:click",(({cell:e})=>{c.value="node",d.value!=e.id&&f(e)})),s.on("edge:click",(({cell:e})=>{c.value="node",d.value!=e.id&&y(e)})),s.on("node:removed",(({cell:e})=>{e.id==d.value&&(d.value="")})),s.on("edge:removed",(({cell:e})=>{e.id==d.value&&(d.value="")})),s.on("node:change:size",(({cell:e})=>{if(d.value!=e.id)return;const{height:l,width:a}=e.getProp("size");i.value.height=l,i.value.width=a})),(()=>{var e;const{panning:l}=v.value;l||null==(e=o.value)||e.disablePanning()})(),await D(),(()=>{const e=l.value.find((e=>e.id==a));if(!e)return;u.value=e,JSON.parse(u.value.data).forEach((e=>{var l,a;const{shape:t}=e;"edge"==t?null==(l=o.value)||l.addEdge(e):null==(a=o.value)||a.addNode(e)}))})()};return G((()=>{te()})),(e,l)=>{const a=b,o=x,g=M,f=C,y=z,A=V,G=j;return T(),I("div",_l,[H(A,null,{default:P((()=>[B("div",{class:"stencil",ref_key:"stencil",ref:r},null,512),H(G,{class:"split",size:h.value,"onUpdate:size":l[2]||(l[2]=e=>h.value=e),max:.73,min:.6},{first:P((()=>[B("div",{class:"container",ref_key:"container",ref:t},null,512)])),second:P((()=>[B("div",xl,[H(A,{class:"property"},{default:P((()=>[H(y,{"active-key":c.value,"onUpdate:activeKey":l[1]||(l[1]=e=>c.value=e)},{default:P((()=>[H(g,{key:"global",title:"全局属性"},{default:P((()=>[H(o,{style:{height:"83vh",overflow:"auto"}},{default:P((()=>[H(E(kl),{property:v.value,ref_key:"propertyForm",ref:m},null,8,["property"]),B("div",Ml,[H(a,{type:"primary",onClick:L},{icon:P((()=>[H(E(k))])),default:P((()=>[F(" 保存设置 ")])),_:1})])])),_:1})])),_:1}),H(g,{key:"node",title:"节点属性"},{default:P((()=>[K(H(o,{style:{height:"82vh",overflow:"auto"}},{default:P((()=>[K(H(E(Fe),{property:i.value,onChange:w},null,8,["property"]),[[q,"node"==n.value]]),K(H(E(Ue),{property:s.value,onChange:U},null,8,["property"]),[[q,"line"==n.value]])])),_:1},512),[[q,d.value]]),K(B("div",null,[H(f,{description:"暂无节点信息"})],512),[[q,!d.value]])])),_:1}),H(g,{key:"draw",title:"绘图信息"},{default:P((()=>[H(E(_e),{model:u.value,"onUpdate:model":l[0]||(l[0]=e=>u.value=e),onChange:S,ref_key:"drawForm",ref:p},null,8,["model"]),B("div",Cl,[H(a,{type:"primary",onClick:W},{icon:P((()=>[H(E(k))])),default:P((()=>[F(" 保存作图 ")])),_:1}),H(a,{onClick:N},{icon:P((()=>[H(E(_))])),default:P((()=>[F(" 导出图片 ")])),_:1})])])),_:1})])),_:1},8,["active-key"])])),_:1})])])),_:1},8,["size"])])),_:1})])}}});export{zl as default};
