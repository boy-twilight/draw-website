import{l as e,F as l,S as a,m as o,n as t,o as r,p as i,q as n,r as d,s,t as u,u as c,R as p,v,w as m,x as h,y as g,z as f,D as b,g as y,E as w,B as k,G as x,H as V,C as _,J as C,K as M,N as z,O as j,Q as S,U,V as T}from"../@arco-design/@arco-design.9fbdd99f.js";import{e as A,t as N,r as P,w as W,k as H,l as E,m as F,v as B,n as I,$ as K,y as D,z as q,p as L,a as G,M as O,N as J,P as R,F as $,s as Q,o as X,C as Y}from"../@vue/@vue.39664cb3.js";import{T as Z,S as ee,a as le,K as ae,C as oe,H as te,E as re,b as ie,G as ne,c as de,d as se}from"../@antv/@antv.354d31c8.js";import{b as ue}from"../vue-router/vue-router.5c0bd928.js";import{c as ce,u as pe,l as ve,f as me}from"../data/data.fabae307.js";import{e as he,n as ge}from"../lodash-es/lodash-es.5d7a2e52.js";import{a as fe}from"../vue3-colorpicker/vue3-colorpicker.88804826.js";import{s as be}from"../pinia/pinia.a4fb185b.js";import{v as ye}from"../uuid/uuid.ba5d26a9.js";import"../resize-observer-polyfill/resize-observer-polyfill.ad543aa3.js";import"../compute-scroll-into-view/compute-scroll-into-view.2962e95c.js";import"../b-tween/b-tween.5055d79e.js";import"../dayjs/dayjs.37468663.js";import"../crypto-js/crypto-js.930e5814.js";import"../scroll-into-view-if-needed/scroll-into-view-if-needed.f139de06.js";import"../b-validate/b-validate.457088db.js";import"../number-precision/number-precision.d9b928a1.js";import"../mousetrap/mousetrap.890cce9b.js";import"../lyc-storage/lyc-storage.653be9fc.js";import"../../static/index-0de2c379.js";import"../nprogress/nprogress.02fc88c0.js";import"../@vueuse/@vueuse.11702cf4.js";import"../tinycolor2/tinycolor2.2b8234f4.js";import"../gradient-parser/gradient-parser.96402e16.js";import"../vue-types/vue-types.52f94848.js";import"../is-plain-object/is-plain-object.32bf4cc1.js";import"../@aesoper/@aesoper.4b44138d.js";import"../@popperjs/@popperjs.396dda61.js";const we=(e,l)=>{for(let a=0;a<e.length;a++)e[a].style.visibility=l?"visible":"hidden"},ke=e=>"none"!=e?{name:e,width:12,height:8}:null,xe=e=>{const l=new Map([["edge-editor",{name:"edge-editor",args:{attrs:{text:{fontSize:15}}}}],["vertices",{name:"vertices"}],["segments",{name:"segments"}],["boundary",{name:"boundary",args:{padding:15}}],["button-remove",{name:"button-remove",args:{distance:"50%"}}],["source-arrowhead",{name:"source-arrowhead"}],["target-arrowhead",{name:"target-arrowhead"}]]);return e.map((e=>l.get(e)))},Ve=e=>{let l={};return l="rounded"==e?{radius:8}:{radius:8,type:"arc",size:8},l},_e=e=>({position:e,attrs:{circle:{r:4.5,magnet:!0,stroke:"#000",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}}),Ce=e=>{const{width:l,height:a,shape:o}=e;return{inherit:o,width:l,height:a,attrs:{body:{strokeWidth:1.5,stroke:"#000000",fill:"#ffffff"},text:{fontSize:12,fill:"#262626",textAnchor:"middle",textVerticalAnchor:"middle",lineHeight:12},label:{textWrap:{width:"90%",height:"90%",ellipsis:!0,breakWord:!0}}},ports:{groups:{top:_e("top"),right:_e("right"),bottom:_e("bottom"),left:_e("left")}}}},Me=e=>(e||["top","bottom","left","right"]).map((e=>({group:e}))),ze=(e,l)=>{let{refPoints:a,width:o,height:t,port:r}=l;return o=o||33,t=t||18,e.createNode({shape:"custom-polygon",width:o,height:t,attrs:{body:{refPoints:a}},ports:{items:Me(r)}})},je=(e,l)=>{const{rx:a,ry:o,port:t}=l;return e.createNode({shape:"custom-rect",attrs:{body:{rx:a,ry:o}},ports:{items:Me(t)}})},Se=e=>{const l=je(e,{rx:0,ry:0}),a=je(e,{rx:6,ry:6}),o=je(e,{rx:10,ry:13}),t=((e,l)=>e.createNode({shape:"custom-ellipse",ports:{items:Me(l)}}))(e),r=((e,l)=>e.createNode({shape:"custom-circle",ports:{items:Me(l)}}))(e);return[l,a,o,t,r,ze(e,{refPoints:"10,0 40,0 30,20 0,20"}),ze(e,{refPoints:"0,10 10,0 20,10 10,20"}),ze(e,{height:25,width:25,refPoints:"0.5,0 0.61,0.35 1,0.35 0.68,0.57 0.79,0.91 0.5,0.75 0.21,0.91 0.32,0.57 0,0.35 0.39,0.35"}),ze(e,{refPoints:"0,0 0,1 1,1",port:["left","bottom"]}),ze(e,{height:22,width:25,refPoints:"0.5,0 1,1 0,1"}),ze(e,{height:25,refPoints:"0.5,0 1,0.38 0.82,1 0.18,1 0,0.38"}),ze(e,{height:28,width:28,refPoints:"0.5,0 1,0.25 1,0.75 0.5,1 0,0.75 0,0.25"}),ze(e,{height:33,refPoints:"0.5,0 0.85,0.15 1,0.5 0.85,0.85 0.5,1 0.15,0.85 0,0.5 0.15,0.15"})]},Ue=A({__name:"index",props:{model:{}},emits:["change"],setup(r,{expose:i,emit:n}){const d=r,s=n,{model:u}=N(d),c=P(u.value),p={name:{message:"绘图名称必须填写",required:!0,type:"string"},desc:{message:"绘图备注必须填写",required:!0,type:"string"},exportType:{message:"导出图片的类型必须选择",required:!0,type:"string"}},v=[{label:"png格式",value:"png"},{label:"jpeg格式",value:"jpeg"},{label:"svg格式",value:"svg"}],m=P();return W(u,(e=>{c.value=he(e)}),{deep:!0}),i({validate:()=>m.value.validate()}),(r,i)=>{const n=e,d=l,u=a,h=o,g=t;return H(),E(g,{model:c.value,rules:p,"label-align":"left","auto-label-width":"",ref_key:"formIns",ref:m},{default:F((()=>[B(d,{label:"名称",field:"name","validate-trigger":"blur"},{default:F((()=>[B(n,{modelValue:c.value.name,"onUpdate:modelValue":i[0]||(i[0]=e=>c.value.name=e),placeholder:"请输入绘图名称",onChange:i[1]||(i[1]=e=>s("change","name",c.value.name))},null,8,["modelValue"])])),_:1}),B(d,{label:"导出类型",field:"exportType","validate-trigger":"blur"},{default:F((()=>[B(u,{modelValue:c.value.exportType,"onUpdate:modelValue":i[2]||(i[2]=e=>c.value.exportType=e),options:v,onChange:i[3]||(i[3]=e=>s("change","exportType",c.value.exportType)),placeholder:"请选择导出图片的类型"},null,8,["modelValue"])])),_:1}),B(d,{label:"备注",field:"desc","validate-trigger":"blur"},{default:F((()=>[B(h,{modelValue:c.value.desc,"onUpdate:modelValue":i[4]||(i[4]=e=>c.value.desc=e),placeholder:"请输入此次绘图的备注","auto-size":{minRows:5},onChange:i[5]||(i[5]=e=>s("change","desc",c.value.desc))},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])}}}),Te={class:"slider-container"},Ae={class:"color"},Ne=I("span",{class:"iconfont line-color"},"",-1),Pe={class:"slider-container"},We={class:"slider-container"},He=A({__name:"index",props:{property:{}},emits:["change"],setup(e,{emit:a}){const o=e,n=a,{property:d}=N(o),s=P(d.value);return W(d,(e=>{s.value=he(e)}),{deep:!0}),W(s,(e=>{ge(e,d.value)||n("change",e)}),{deep:!0}),(e,a)=>{const o=r,n=l,u=i,c=t;return H(),E(c,{model:K(d),"label-align":"left","auto-label-width":""},{default:F((()=>[B(n,{label:"线条宽度",field:"strokeWidth"},{default:F((()=>[I("div",Te,[B(o,{modelValue:s.value.strokeWidth,"onUpdate:modelValue":a[0]||(a[0]=e=>s.value.strokeWidth=e),modelModifiers:{lazy:!0},min:1,max:100,"show-input":""},null,8,["modelValue"])])])),_:1}),B(n,{label:"线条颜色",field:"strokeColor"},{default:F((()=>[I("div",Ae,[B(K(fe),{pureColor:s.value.strokeColor,"onUpdate:pureColor":a[1]||(a[1]=e=>s.value.strokeColor=e),format:"hex6"},null,8,["pureColor"]),B(u,null,{icon:F((()=>[Ne])),default:F((()=>[D(" "+q(s.value.strokeColor),1)])),_:1})])])),_:1}),B(n,{label:"箭头宽度",field:"markerWidth"},{default:F((()=>[I("div",Pe,[B(o,{modelValue:s.value.markerWidth,"onUpdate:modelValue":a[2]||(a[2]=e=>s.value.markerWidth=e),modelModifiers:{lazy:!0},min:5,max:100,"show-input":""},null,8,["modelValue"])])])),_:1}),B(n,{label:"箭头高度",field:"markerHeight"},{default:F((()=>[I("div",We,[B(o,{modelValue:s.value.markerHeight,"onUpdate:modelValue":a[3]||(a[3]=e=>s.value.markerHeight=e),modelModifiers:{lazy:!0},min:5,max:100,"show-input":""},null,8,["modelValue"])])])),_:1})])),_:1},8,["model"])}}}),Ee={class:"slider-container"},Fe={class:"slider-container"},Be={class:"color"},Ie={class:"slider-container"},Ke={class:"color"},De={class:"slider-container"},qe={class:"slider-container"},Le={class:"color"},Ge=I("span",{class:"iconfont line-color"},"",-1),Oe=A({__name:"index",props:{property:{}},emits:["change"],setup(e,{emit:a}){const o=e,m=a,{property:h}=N(o),g=P(h.value);return W(h,(e=>{g.value=he(e)}),{deep:!0}),W(g,(e=>{ge(h.value,e)||m("change",e)}),{deep:!0}),(e,a)=>{const o=r,m=l,f=i,b=p,y=v,w=t;return H(),E(w,{model:K(h),"label-align":"left","auto-label-width":""},{default:F((()=>[B(m,{label:"高度",field:"height"},{default:F((()=>[I("div",Ee,[B(o,{modelValue:g.value.height,"onUpdate:modelValue":a[0]||(a[0]=e=>g.value.height=e),modelModifiers:{lazy:!0},min:10,max:1e3,"show-input":""},null,8,["modelValue"])])])),_:1}),B(m,{label:"宽度",field:"width"},{default:F((()=>[I("div",Fe,[B(o,{modelValue:g.value.width,"onUpdate:modelValue":a[1]||(a[1]=e=>g.value.width=e),modelModifiers:{lazy:!0},min:10,max:1e3,"show-input":""},null,8,["modelValue"])])])),_:1}),B(m,{label:"填充颜色",field:"background"},{default:F((()=>[I("div",Be,[B(K(fe),{pureColor:g.value.background,"onUpdate:pureColor":a[2]||(a[2]=e=>g.value.background=e),format:"hex6"},null,8,["pureColor"]),B(f,null,{icon:F((()=>[B(K(n),{size:16})])),default:F((()=>[D(" "+q(g.value.background),1)])),_:1})])])),_:1}),B(m,{label:"字体大小",field:"fontSize"},{default:F((()=>[I("div",Ie,[B(o,{modelValue:g.value.fontSize,"onUpdate:modelValue":a[3]||(a[3]=e=>g.value.fontSize=e),modelModifiers:{lazy:!0},min:10,max:100,"show-input":""},null,8,["modelValue"])])])),_:1}),B(m,{label:"字体颜色",field:"fontColor"},{default:F((()=>[I("div",Ke,[B(K(fe),{pureColor:g.value.fontColor,"onUpdate:pureColor":a[4]||(a[4]=e=>g.value.fontColor=e),format:"hex6"},null,8,["pureColor"]),B(f,null,{icon:F((()=>[B(K(d),{size:15})])),default:F((()=>[D(" "+q(g.value.fontColor),1)])),_:1})])])),_:1}),B(m,{label:"对齐",field:"textAnchor"},{default:F((()=>[B(y,{modelValue:g.value.textAnchor,"onUpdate:modelValue":a[5]||(a[5]=e=>g.value.textAnchor=e),type:"button",size:"small"},{default:F((()=>[B(b,{value:"end"},{default:F((()=>[B(K(s))])),_:1}),B(b,{value:"middle"},{default:F((()=>[B(K(u))])),_:1}),B(b,{value:"start"},{default:F((()=>[B(K(c))])),_:1})])),_:1},8,["modelValue"])])),_:1}),B(m,{label:"行高",field:"lineHeight"},{default:F((()=>[I("div",De,[B(o,{modelValue:g.value.lineHeight,"onUpdate:modelValue":a[6]||(a[6]=e=>g.value.lineHeight=e),modelModifiers:{lazy:!0},min:10,max:100,"show-input":""},null,8,["modelValue"])])])),_:1}),B(m,{label:"线条宽度",field:"borderSize"},{default:F((()=>[I("div",qe,[B(o,{modelValue:g.value.borderSize,"onUpdate:modelValue":a[7]||(a[7]=e=>g.value.borderSize=e),modelModifiers:{lazy:!0},min:1,max:100,"show-input":""},null,8,["modelValue"])])])),_:1}),B(m,{label:"线条颜色",field:"borderColor"},{default:F((()=>[I("div",Le,[B(K(fe),{pureColor:g.value.borderColor,"onUpdate:pureColor":a[8]||(a[8]=e=>g.value.borderColor=e),format:"hex6"},null,8,["pureColor"]),B(f,null,{icon:F((()=>[Ge])),default:F((()=>[D(" "+q(g.value.borderColor),1)])),_:1})])])),_:1})])),_:1},8,["model"])}}}),Je=A({__name:"index",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(e,{emit:l}){const a=l,o=e=>{a("update:modelValue",e)};return(e,l)=>{const a=g;return H(),L("div",null,[B(a,{"model-value":e.modelValue,"checked-value":!0,"unchecked-value":!1,"checked-text":"开启","unchecked-text":"关闭",onChange:o},{"checked-icon":F((()=>[B(K(m))])),"unchecked-icon":F((()=>[B(K(h))])),default:F((()=>[D("> "),D("> ")])),_:1},8,["model-value"])])}}}),Re=I("span",{class:"title"},"画布属性：",-1),$e={class:"upload"},Qe={class:"slider-container"},Xe={class:"color"},Ye={class:"slider-container"},Ze=I("span",{class:"title"},"线条属性：",-1),el={class:"label"},ll={class:"label"},al=I("span",null,"自动吸附",-1),ol={class:"slider-container"},tl={class:"label"},rl=I("span",null,"边上工具",-1),il=I("span",{class:"title"},"连接属性：",-1),nl={class:"label"},dl=A({__name:"index",props:{property:{}},setup(e,{expose:o}){const d=e,{property:s}=N(d),u=P(s.value),c=[{label:"没有箭头",value:"none"},{label:"实心箭头",value:"block"},{label:"经典箭头",value:"classic"},{label:"菱形箭头",value:"diamond"},{label:"圆形箭头",value:"circle"},{label:"圆形和加号箭头",value:"circlePlus"},{label:"椭圆箭头",value:"ellipse"},{label:"交叉箭头",value:"cross"},{label:"async",value:"async"}],m=[{label:"文本编辑工具",value:"edge-editor"},{label:"起点修改工具",value:"source-arrowhead"},{label:"终点修改工具",value:"target-arrowhead"},{label:"路径点工具",value:"vertices"},{label:"矩形框工具",value:"boundary"},{label:"删除工具",value:"button-remove"},{label:"线段工具",value:"segments"}],h=G([{field:"embedding",label:"节点嵌套",tooltip:"是否允许一个节点在另外一个节点内部成为子节点，默认开启。"},{field:"allowPort",label:"连接",tooltip:"是否允许边链接到连接桩，默认开启。"},{field:"allowEdge",label:"边边连接",tooltip:"一条边连接另一条边，默认开启。"},{field:"allowBlank",label:"空白连接",tooltip:"是否允许连接到画布空白位置的点，默认开启。"},{field:"allowLoop",label:"循环连接",tooltip:"是否允许创建循环连线，即边的起始节点和终止节点为同一节点，默认开启。"},{field:"allowMulti",label:"节点多边连接",tooltip:"是否允许在相同的起始节点和终止之间创建多条边，默认开启。当关闭时，在起始和终止节点之间只允许创建一条边。"},{field:"allowNode",label:"非连接桩连接",tooltip:"是否允许边连接到节点（非节点上的连接桩），默认开启 。"},{field:"highlight",label:"连接高光",tooltip:"拖动边时，是否高亮显示所有可用的连接桩或节点，默认关闭。"},{field:"nodeMovable",label:"节点拖拽",tooltip:"节点是否可以被移动，默认开启。"},{field:"edgeMovable",label:"边拖拽",tooltip:"边是否可以被移动，默认开启。"},{field:"edgeLabelMovable",label:"边标签拖拽",tooltip:"边的标签是否可以被移动，默认开启。"},{field:"arrowheadMovable",label:"箭头拖拽",tooltip:"边的起始/终止箭头是否可以被移动，默认开启。"},{field:"vertexMovable",label:"路径点拖拽",tooltip:"边的路径点是否可以被移动，默认开启。"},{field:"vertexAddable",label:"添加路径点",tooltip:"是否可以添加边的路径点，默认开启。"},{field:"vertexDeletable",label:"删除路径点",tooltip:" 边的路径点是否可以被删除，默认开启。"}]),g=P([{label:"线条类型",field:"lineType",tooltip:"",htmlType:"radio",options:[{label:"实线",value:""},{label:"虚线",value:"7,7"}]},{label:"起点箭头",field:"sourceMarker",tooltip:"",htmlType:"select",options:c},{label:"终点箭头",field:"targetMarker",tooltip:"",htmlType:"select",options:c},{label:"路由模式",field:"router",tooltip:"路由将边的路径点做进一步转换处理，并在必要时添加额外的点，然后返回处理后的点（不包含边的起点和终点）。例如，经过正交路由路由处理后，边的每一条线段都是水平或垂直的正交线段，默认为\t智能正交路由。",htmlType:"select",options:[{label:"内置路由",value:"normal"},{label:"正交路由",value:"orth"},{label:"受限正交路由",value:"oneSide"},{label:"智能正交路由",value:"manhattan"},{label:"智能地铁线路由",value:"metro"},{label:"实体关系路由",value:"er"}]},{label:"连接器",field:"connector",tooltip:"连接起点、终点、路有点的连线类型，默认为圆角连接器。",htmlType:"select",options:[{label:"简单连接器",value:"normal"},{label:"平滑连接器",value:"smooth"},{label:"圆角连接器",value:"rounded"},{label:"跳线连接器",value:"jumpover"}]}]),_=()=>{const e=document.createElement("input");e.type="file",e.accept=".png,.jpeg,.jpg,.gif,.bmp",e.style.display="none",e.onchange=async e=>{const l=e.target.files;if(l.length<=0)return;const a=l[0];if(!/\.(jpg|jpeg|png|gif|bmp)$/i.test(a.name))return y.error("请上传图像文件");const o=await ce(a,4320,7680,.6);u.value.bgImage=o},document.body.appendChild(e),e.click(),document.body.removeChild(e)};return o({getFormValue:()=>u.value}),(e,o)=>{const d=p,c=v,y=l,C=w,M=k,z=r,j=i,S=x,U=a,T=V,A=t;return H(),E(A,{model:K(s),"label-align":"left","auto-label-width":""},{default:F((()=>[Re,B(y,{label:"背景模式",field:"bgMode"},{default:F((()=>[B(c,{modelValue:u.value.bgMode,"onUpdate:modelValue":o[0]||(o[0]=e=>u.value.bgMode=e)},{default:F((()=>[B(d,{value:"color"},{default:F((()=>[D("纯色背景")])),_:1}),B(d,{value:"image"},{default:F((()=>[D("图像背景")])),_:1})])),_:1},8,["modelValue"])])),_:1}),O(B(y,{label:"背景图像",field:"bgImage"},{default:F((()=>[I("div",$e,[B(C,{width:"150",height:"150",src:u.value.bgImage,style:{cursor:"pointer"}},null,8,["src"]),B(M,{onClick:_},{icon:F((()=>[B(K(f))])),default:F((()=>[D(" 上传 ")])),_:1})])])),_:1},512),[[J,"image"==u.value.bgMode]]),O(B(y,{label:"背景透明度",field:"opacity"},{default:F((()=>[I("div",Qe,[B(z,{modelValue:u.value.opacity,"onUpdate:modelValue":o[1]||(o[1]=e=>u.value.opacity=e),modelModifiers:{lazy:!0},min:.1,max:1,step:.1,"show-input":""},null,8,["modelValue"])])])),_:1},512),[[J,"image"==u.value.bgMode]]),B(y,{label:"背景色",field:"background"},{default:F((()=>[I("div",Xe,[B(K(fe),{pureColor:u.value.background,"onUpdate:pureColor":o[2]||(o[2]=e=>u.value.background=e),format:"hex6"},null,8,["pureColor"]),B(j,null,{icon:F((()=>[B(K(n),{size:16})])),default:F((()=>[D(" "+q(u.value.background),1)])),_:1})])])),_:1}),B(y,{label:"画布缩放",field:"mousewheel"},{default:F((()=>[B(Je,{modelValue:u.value.mousewheel,"onUpdate:modelValue":o[3]||(o[3]=e=>u.value.mousewheel=e)},null,8,["modelValue"])])),_:1}),O(B(y,{label:"缩放倍率",field:"scale"},{default:F((()=>[I("div",Ye,[B(z,{modelValue:u.value.scale,"onUpdate:modelValue":o[4]||(o[4]=e=>u.value.scale=e),min:.1,max:5,step:.1,range:"","show-input":""},null,8,["modelValue"])])])),_:1},512),[[J,u.value.mousewheel]]),B(y,{label:"画布平移",field:"panning"},{default:F((()=>[B(Je,{modelValue:u.value.panning,"onUpdate:modelValue":o[5]||(o[5]=e=>u.value.panning=e)},null,8,["modelValue"])])),_:1}),Ze,(H(!0),L($,null,R(g.value,(e=>(H(),E(y,{key:e.field,field:e.field},{label:F((()=>[I("div",el,[I("span",null,q(e.label),1),e.tooltip?(H(),E(S,{key:0,content:e.tooltip},{default:F((()=>[B(K(b))])),_:2},1032,["content"])):Q("",!0)])])),default:F((()=>["select"==e.htmlType?(H(),E(U,{key:0,modelValue:u.value[e.field],"onUpdate:modelValue":l=>u.value[e.field]=l,options:e.options},null,8,["modelValue","onUpdate:modelValue","options"])):(H(),E(c,{key:1,modelValue:u.value[e.field],"onUpdate:modelValue":l=>u.value[e.field]=l,options:e.options},null,8,["modelValue","onUpdate:modelValue","options"]))])),_:2},1032,["field"])))),128)),B(y,{field:"snap"},{label:F((()=>[I("div",ll,[al,B(S,{content:"开启和关闭连线过程中自动吸附，数值大小代表吸附距离，默认值是20px。"},{default:F((()=>[B(K(b))])),_:1})])])),default:F((()=>[I("div",ol,[B(z,{modelValue:u.value.snap,"onUpdate:modelValue":o[6]||(o[6]=e=>u.value.snap=e),modelModifiers:{lazy:!0},min:1,max:100,"show-input":""},null,8,["modelValue"])])])),_:1}),B(y,{field:"lineTools"},{label:F((()=>[I("div",tl,[rl,B(S,{content:"开启边的一些小工具便于操作，默认有边上编辑工具。"},{default:F((()=>[B(K(b))])),_:1})])])),default:F((()=>[B(T,{modelValue:u.value.lineTools,"onUpdate:modelValue":o[7]||(o[7]=e=>u.value.lineTools=e),options:m},null,8,["modelValue"])])),_:1}),il,(H(!0),L($,null,R(h,(e=>(H(),E(y,{key:e.field,field:e.field},{label:F((()=>[I("div",nl,[I("span",null,q(e.label),1),e.tooltip?(H(),E(S,{key:0,content:e.tooltip},{default:F((()=>[B(K(b))])),_:2},1032,["content"])):Q("",!0)])])),default:F((()=>[B(Je,{modelValue:u.value[e.field],"onUpdate:modelValue":l=>u.value[e.field]=l},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["field"])))),128))])),_:1},8,["model"])}}}),sl={class:"draw"},ul={class:"operation"},cl={class:"footer"},pl={class:"footer"},vl=A({__name:"index",setup(e){const{userData:l}=be(pe()),a=ue().query.id+"",o=P(),t=P(),r=P(),i=P({id:"",name:"",desc:"",data:"",exportType:"png",createTime:"",updateTime:""}),n=P(""),d=P("node"),s=P({width:0,height:0,fontColor:"",fontSize:0,lineHeight:0,background:"",borderColor:"",borderSize:0,textAnchor:"",textVerticalAnchor:""}),u=P({strokeColor:"",strokeWidth:0,markerHeight:0,markerWidth:0}),c=P("global"),p=P(ve.get("setting")||{bgImage:"",bgMode:"color",opacity:.6,background:"#ffffff",mousewheel:!0,scale:[.3,3],panning:!0,embedding:!0,allowBlank:!0,allowLoop:!0,allowMulti:!0,allowPort:!0,highlight:!1,allowEdge:!0,allowNode:!0,nodeMovable:!0,edgeMovable:!0,edgeLabelMovable:!0,arrowheadMovable:!0,vertexMovable:!0,vertexAddable:!0,vertexDeletable:!0,sourceMarker:"none",targetMarker:"block",router:"manhattan",connector:"rounded",lineType:"",snap:20,lineTools:["edge-editor"],nodeTools:["node-editor"]}),v=P(),m=P(),h=P(.73),g=e=>{n.value=e.id,d.value="node";const l=e.getAttrs(),{width:a,height:o}=e.getProp("size"),{body:{fill:t,stroke:r,strokeWidth:i},text:{fill:u,fontSize:c,textAnchor:p,textVerticalAnchor:v,lineHeight:m}}=l;s.value={width:a,height:o,fontSize:Number(c),fontColor:String(u),borderColor:String(r),borderSize:Number(i),background:String(t),textAnchor:String(p),lineHeight:Number(m),textVerticalAnchor:String(v)}},f=e=>{n.value=e.id,d.value="line";const l=e.getAttrs(),{line:{stroke:a,strokeWidth:o,targetMarker:t}}=l,{height:r,width:i}=Object(t);u.value={strokeWidth:Number(o),strokeColor:String(a),markerHeight:r||0,markerWidth:i||0}},b=e=>{const l=o.value.getCellById(n.value),{background:a,borderColor:t,borderSize:r,fontColor:i,fontSize:d,textAnchor:u,textVerticalAnchor:c,height:p,width:v,lineHeight:m}=e;l.setAttrs({body:{fill:a,stroke:t,strokeWidth:r},text:{fill:i,fontSize:d,textAnchor:u,textVerticalAnchor:c,lineHeight:m}}),l.setProp("size",{width:v,height:p}),s.value=e},w=e=>{const l=o.value.getCellById(n.value),{markerWidth:a,markerHeight:t,strokeWidth:r,strokeColor:i}=e;l.setAttrs({line:{stroke:i,strokeWidth:r,sourceMarker:{height:t,width:a},targetMarker:{height:t,width:a}}}),u.value=e},x=(e,l)=>{i.value[e]=l},V=()=>{const{exportType:e}=i.value;"png"==e?o.value.exportPNG():"jpeg"==e?o.value.exportJPEG():o.value.exportSVG()},A=async()=>{var e;if(await(null==(e=v.value)?void 0:e.validate()))return c.value="draw",y.error("请填写完整绘图名称和绘图备注后，在进行保存！");i.value.data=JSON.stringify(o.value.toJSON().cells);const t=l.value.findIndex((e=>e.id==a));if(-1!=t)i.value.updateTime=me(new Date),l.value[t]=i.value,y.success("修改保存成功！");else{i.value.id=ye();const e=new Date;i.value.createTime=me(e),i.value.updateTime=me(e),l.value.push(i.value),y.success("新增保存成功！")}},N=()=>{ve.set("setting",m.value.getFormValue()),location.reload()},W=async()=>{var e,u;ne.registerNode("custom-rect",Ce({shape:"rect",width:33,height:18}),!0),ne.registerNode("custom-polygon",Ce({shape:"polygon",width:33,height:18}),!0),ne.registerNode("custom-circle",Ce({shape:"circle",width:23,height:23}),!0),ne.registerNode("custom-ellipse",Ce({shape:"ellipse",width:33,height:18}),!0),o.value=(e=t.value,new ne({container:e,background:{color:"color"==p.value.bgMode?"transparent":p.value.background,image:"color"==p.value.bgMode?"":p.value.bgImage,opacity:p.value.opacity,position:"center"},grid:{type:"doubleMesh",size:12,visible:!0,args:[{color:"#eee",thickness:1},{color:"#ddd",thickness:1,factor:4}]},embedding:p.value.embedding,mousewheel:{enabled:p.value.mousewheel,zoomAtMousePosition:!0,modifiers:["ctrl","meta"],minScale:p.value.scale[0],maxScale:p.value.scale[1]},interacting:{edgeLabelMovable:p.value.edgeLabelMovable,edgeMovable:p.value.edgeMovable,arrowheadMovable:p.value.arrowheadMovable,nodeMovable:p.value.nodeMovable,vertexMovable:p.value.vertexMovable,vertexAddable:p.value.vertexAddable,vertexDeletable:p.value.vertexDeletable},connecting:{router:p.value.router,anchor:"center",connectionPoint:"anchor",connector:{name:p.value.connector,args:Ve(p.value.connector)},snap:{radius:p.value.snap},allowBlank:p.value.allowBlank,allowEdge:p.value.allowEdge,allowPort:p.value.allowPort,allowLoop:p.value.allowLoop,allowMulti:p.value.allowMulti,allowNode:p.value.allowNode,highlight:p.value.highlight,createEdge(){const e=new de({attrs:{line:{stroke:"#000000",strokeWidth:2,sourceMarker:ke(p.value.sourceMarker),targetMarker:ke(p.value.targetMarker),"stroke-dasharray":p.value.lineType}},tools:xe(p.value.lineTools),zIndex:0});return n.value=e.id,c.value="node",d.value="line",f(e),e},validateConnection:({targetMagnet:e})=>!!e},highlighting:{magnetAdsorbed:{name:"stroke",args:{attrs:{fill:"#5F95FF",stroke:"#5F95FF",strokeWidth:5}}}}})),(e=>{e.use(new Z({resizing:{enabled:!0,preserveAspectRatio:!0},rotating:{enabled:!0}})).use(new ee({rubberband:!0,showNodeSelectionBox:!0,showEdgeSelectionBox:!0})).use(new le({className:"snapline"})).use(new ae).use(new oe).use(new te).use(new re).use(new ie({modifiers:["ctrl","meta"],pannable:!0})),e.lockScroller()})(o.value),(e=>{var l;const a=new se({title:"流程图基础图形",target:e,stencilGraphWidth:200,stencilGraphHeight:250,collapsable:!1,groups:[{title:"基础图形",name:"node"}],layoutOptions:{columns:3,columnWidth:53,rowHeight:45},getDropNode(e){const l=e.size(),a=e.clone().size({height:2*l.height,width:2*l.width});return a.addTools([{name:"node-editor",args:{attrs:{fontSize:16,backgroundColor:"#fff"}}}]),c.value="node",g(a),a}});a.load(Se(e),"node"),null==(l=r.value)||l.appendChild(a.container)})(o.value),(e=>{e.bindKey(["meta+c","ctrl+c"],(()=>{const l=e.getSelectedCells();return l.length&&e.copy(l),!1})),e.bindKey(["meta+x","ctrl+x"],(()=>{const l=e.getSelectedCells();return l.length&&e.cut(l),!1})),e.bindKey(["meta+v","ctrl+v"],(()=>{if(!e.isClipboardEmpty()){const l=e.paste({offset:32});e.cleanSelection(),e.select(l)}return!1})),e.bindKey(["meta+z","ctrl+z"],(()=>(e.canUndo()&&e.undo(),!1))),e.bindKey(["meta+shift+z","ctrl+shift+z"],(()=>(e.canRedo()&&e.redo(),!1))),e.bindKey(["meta+a","ctrl+a"],(()=>{const l=e.getNodes();l&&e.select(l)})),e.bindKey("backspace",(()=>{const l=e.getSelectedCells();l.length&&e.removeCells(l)}))})(o.value),(u=o.value).on("node:mouseenter",(()=>{const e=t.value.querySelectorAll(".x6-port-body");we(e,!0)})),u.on("node:mouseleave",(()=>{const e=t.value.querySelectorAll(".x6-port-body");we(e,!1)})),u.on("node:click",(({cell:e})=>{c.value="node",n.value!=e.id&&g(e)})),u.on("edge:click",(({cell:e})=>{c.value="node",n.value!=e.id&&f(e)})),u.on("node:removed",(({cell:e})=>{e.id==n.value&&(n.value="")})),u.on("edge:removed",(({cell:e})=>{e.id==n.value&&(n.value="")})),u.on("node:change:size",(({cell:e})=>{if(n.value!=e.id)return;const{height:l,width:a}=e.getProp("size");s.value.height=l,s.value.width=a})),(()=>{var e;const{panning:l}=p.value;l||null==(e=o.value)||e.disablePanning()})(),await Y(),(()=>{const e=l.value.find((e=>e.id==a));if(!e)return;i.value=e,JSON.parse(i.value.data).forEach((e=>{var l,a;const{shape:t}=e;"edge"==t?null==(l=o.value)||l.addEdge(e):null==(a=o.value)||a.addNode(e)}))})()};return X((()=>{W()})),(e,l)=>{const a=k,o=z,g=j,f=S,y=U,P=_,W=T;return H(),L("div",sl,[B(P,null,{default:F((()=>[I("div",{class:"stencil",ref_key:"stencil",ref:r},null,512),B(W,{class:"split",size:h.value,"onUpdate:size":l[2]||(l[2]=e=>h.value=e),max:.73,min:.6},{first:F((()=>[I("div",{class:"container",ref_key:"container",ref:t},null,512)])),second:F((()=>[I("div",ul,[B(P,{class:"property"},{default:F((()=>[B(y,{"active-key":c.value,"onUpdate:activeKey":l[1]||(l[1]=e=>c.value=e)},{default:F((()=>[B(g,{key:"global",title:"全局属性"},{default:F((()=>[B(o,{style:{height:"83vh",overflow:"auto"}},{default:F((()=>[B(K(dl),{property:p.value,ref_key:"propertyForm",ref:m},null,8,["property"]),I("div",cl,[B(a,{type:"primary",onClick:N},{icon:F((()=>[B(K(C))])),default:F((()=>[D(" 保存设置 ")])),_:1})])])),_:1})])),_:1}),B(g,{key:"node",title:"节点属性"},{default:F((()=>[O(B(o,{style:{height:"82vh",overflow:"auto"}},{default:F((()=>[O(B(K(Oe),{property:s.value,onChange:b},null,8,["property"]),[[J,"node"==d.value]]),O(B(K(He),{property:u.value,onChange:w},null,8,["property"]),[[J,"line"==d.value]])])),_:1},512),[[J,n.value]]),O(I("div",null,[B(f,{description:"暂无节点信息"})],512),[[J,!n.value]])])),_:1}),B(g,{key:"draw",title:"绘图信息"},{default:F((()=>[B(K(Ue),{model:i.value,"onUpdate:model":l[0]||(l[0]=e=>i.value=e),onChange:x,ref_key:"drawForm",ref:v},null,8,["model"]),I("div",pl,[B(a,{type:"primary",onClick:A},{icon:F((()=>[B(K(C))])),default:F((()=>[D(" 保存作图 ")])),_:1}),B(a,{onClick:V},{icon:F((()=>[B(K(M))])),default:F((()=>[D(" 导出图片 ")])),_:1})])])),_:1})])),_:1},8,["active-key"])])),_:1})])])),_:1},8,["size"])])),_:1})])}}});export{vl as default};
